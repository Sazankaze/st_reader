(function(){"use strict";var e={1315:function(e,t,s){var a=s(3751),i=(s(8111),s(2489),s(8237),s(641)),o=s(33);const n={key:0,class:"upload-area"},l={class:"upload-container"},r={key:0,class:"upload-card single-upload"},c={for:"file-input",class:"upload-label"},d={key:1,class:"upload-card zip-upload"},h={for:"zip-input",class:"upload-label"},g={key:2,class:"loading-status"},u={key:1,class:"dashboard-container"},p={class:"dashboard-header"},m={class:"header-column"},v={class:"header-title-row"},k={class:"dashboard-meta"},y={class:"dashboard-content"},b={class:"stats-overview"},f={class:"stat-hero"},x={class:"hero-value"},S={class:"stat-sub-row"},C={class:"sub-stat"},L={class:"sub-value"},F={class:"sub-stat"},w={class:"sub-value"},M={class:"sub-stat"},T={class:"sub-value"},D={key:0,class:"dashboard-calendar-section"},I={class:"dash-cal-header"},E={class:"dash-cal-title"},_={class:"dash-cal-meta"},P={class:"calendar-widget dashboard-widget"},R={class:"calendar-nav"},N=["disabled"],$={class:"current-month-label"},X=["disabled"],O={class:"month-card single-view"},U={class:"month-grid"},z=["onMouseenter"],A={class:"day-number"},H={class:"month-footer-stats"},W={class:"footer-stat"},Q={class:"f-value"},J={class:"footer-stat"},j={class:"f-value"},V={class:"filter-bar"},G={class:"character-groups"},B={class:"char-header"},Y={class:"char-header-left"},q={class:"char-name"},K={class:"char-stats"},Z=["onClick"],ee={class:"file-grid"},te=["onClick"],se={class:"file-info"},ae=["title"],ie={class:"file-meta"},oe={class:"meta-tag cn"},ne={class:"meta-tag turns"},le={class:"file-date"},re={key:2,class:"chat-container"},ce={class:"chat-header"},de={class:"header-content"},he={class:"chat-title"},ge={class:"chat-meta"},ue={key:0},pe={class:"message-count"},me={class:"header-actions"},ve={key:0},ke={key:0},ye={class:"header-actions"},be={key:0},fe={class:"icon-label-row"},xe={key:0,class:"search-bar"},Se={class:"search-input-wrapper"},Ce={class:"search-info"},Le={key:0},Fe={key:1,class:"regex-manager tag-filter-manager"},we={class:"regex-header"},Me={class:"regex-actions"},Te={key:0,class:"script-form"},De={class:"form-group"},Ie={class:"form-group"},Ee={class:"form-group"},_e={class:"form-group checkbox-group"},Pe={class:"form-buttons"},Re={class:"script-list"},Ne={key:0,class:"no-scripts"},$e={class:"script-info"},Xe={class:"script-name"},Oe={class:"script-regex"},Ue={class:"script-controls"},ze=["onClick","disabled"],Ae=["onClick","disabled"],He=["onClick"],We=["onClick"],Qe=["onClick"],Je={key:2,class:"regex-manager"},je={class:"regex-header"},Ve={class:"regex-actions"},Ge=["disabled"],Be={key:0,class:"script-form"},Ye={class:"form-group"},qe={class:"form-group"},Ke={class:"form-group"},Ze={class:"form-group checkbox-group"},et={class:"form-buttons"},tt={class:"script-list"},st={key:0,class:"no-scripts"},at=["onDragstart","onDrop"],it={class:"script-info"},ot={class:"script-name"},nt={class:"script-regex"},lt={class:"script-controls"},rt=["onClick","disabled"],ct=["onClick","disabled"],dt=["onClick"],ht=["onClick"],gt=["onClick"],ut={key:3,class:"regex-manager favorites-panel"},pt={class:"regex-header"},mt={class:"regex-actions"},vt=["disabled"],kt=["disabled"],yt={class:"script-list favorites-list"},bt={key:0,class:"no-scripts"},ft=["onClick"],xt={class:"favorite-content"},St={class:"favorite-type"},Ct={class:"favorite-text"},Lt={class:"favorite-meta"},Ft={key:0},wt={class:"favorite-actions"},Mt=["onClick"],Tt=["onClick"],Dt={key:4,class:"regex-manager style-panel"},It={class:"regex-header"},Et={class:"regex-actions"},_t={class:"style-settings"},Pt={class:"style-group font-group"},Rt={class:"style-flex-row"},Nt={key:0,label:"è‡ªå®šä¹‰å­—ä½“"},$t=["value"],Xt={class:"sliders-grid"},Ot={class:"style-group compact-group"},Ut={class:"style-label"},zt={class:"style-group compact-group"},At={class:"style-label"},Ht={class:"style-group compact-group"},Wt={class:"style-label"},Qt={class:"style-group compact-group"},Jt={class:"style-label"},jt={class:"color-grid"},Vt={class:"style-group compact-group"},Gt={class:"color-picker-row"},Bt={class:"color-value"},Yt={class:"style-group compact-group"},qt={class:"color-picker-row"},Kt={class:"color-value"},Zt={class:"style-group compact-group"},es={class:"color-picker-row"},ts={class:"color-value"},ss={class:"style-group compact-group"},as={class:"color-picker-row"},is={class:"color-value"},os={class:"style-group"},ns={class:"align-options"},ls={class:"style-preview"},rs={key:0,class:"custom-fonts-section"},cs={class:"custom-font-list"},ds={class:"custom-font-name"},hs=["onClick"],gs={class:"modal-dialog custom-font-dialog"},us={class:"modal-header"},ps={class:"modal-body"},ms={class:"form-group"},vs={class:"import-tabs"},ks={class:"import-method"},ys=["disabled"],bs={class:"import-method"},fs=["disabled"],xs={key:0,class:"file-selected"},Ss={class:"modal-footer"},Cs={class:"message-header"},Ls={class:"speaker-name"},Fs={class:"message-info"},ws={key:0,class:"timestamp"},Ms={key:1,class:"model-tag"},Ts=["onClick","title"],Ds=["onClick","title"],Is={key:0,class:"message-edit-form"},Es={class:"edit-actions"},_s=["onMouseup"],Ps=["innerHTML"],Rs={key:1,class:"message-content-html"},Ns={class:"html-preview-header"},$s=["onClick"],Xs=["srcdoc"],Os={key:1,class:"html-code"},Us=["innerHTML","onMouseup"],zs={key:2,class:"swipe-controls"},As=["onClick","disabled"],Hs={class:"swipe-indicator"},Ws=["onClick","disabled"],Qs=["innerHTML"],Js={class:"reading-progress"},js={class:"reading-floor"},Vs={class:"reading-controls"},Gs=["disabled"],Bs=["disabled"],Ys={key:9,class:"pagination-bar pagination-bottom"},qs={class:"pagination-info"},Ks={key:0,class:"filter-hint"},Zs={class:"pagination-controls"},ea=["disabled"],ta=["disabled"],sa={class:"page-indicator"},aa=["disabled"],ia=["disabled"],oa={class:"export-dialog"},na={class:"export-dialog-header"},la={class:"export-dialog-body"},ra={class:"export-range"},ca={class:"range-inputs"},da={class:"range-input-group"},ha=["max"],ga={class:"range-input-group"},ua=["max"],pa={class:"range-hint"},ma={class:"export-options"},va={class:"export-option"},ka={class:"export-option"},ya={class:"export-preview"},ba={class:"export-preview-content"},fa={class:"export-dialog-footer"},xa={class:"modal-dialog intimacy-dialog"},Sa={class:"modal-header"},Ca={class:"modal-body"},La={class:"stats-grid"},Fa={class:"stat-card"},wa={class:"stat-value text-sm"},Ma={class:"stat-sub"},Ta={class:"stat-card"},Da={class:"stat-value"},Ia={class:"stat-card"},Ea={class:"stat-value"},_a={class:"stat-sub"},Pa={class:"stat-card"},Ra={class:"stat-value"},Na={class:"calendar-section"},$a={key:0,class:"calendar-widget"},Xa={class:"calendar-nav"},Oa=["disabled"],Ua={class:"current-month-label"},za=["disabled"],Aa={class:"month-card single-view"},Ha={class:"month-grid"},Wa=["onMouseenter"],Qa={class:"day-number"},Ja={class:"month-footer-stats"},ja={class:"footer-stat"},Va={class:"f-value"},Ga={class:"footer-stat"},Ba={class:"f-value"},Ya={key:1,class:"no-calendar-data"},qa={class:"tooltip-header"},Ka={class:"tooltip-row"},Za={class:"tooltip-row"};function ei(e,t,s,ei,ti,si){const ai=(0,i.g2)("Icon");return(0,i.uX)(),(0,i.CE)("div",{class:(0,o.C4)(["st-reader",{"dark-mode":ti.isDarkMode}])},["home"===ti.viewMode?((0,i.uX)(),(0,i.CE)("div",n,[(0,i.Lk)("div",l,[ti.loadingStatus?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",r,[(0,i.Lk)("input",{type:"file",ref:"fileInput",onChange:t[0]||(t[0]=(...e)=>si.handleFileUpload&&si.handleFileUpload(...e)),accept:".jsonl",id:"file-input",class:"file-input"},null,544),(0,i.Lk)("label",c,[(0,i.bF)(ai,{icon:"bi:file-earmark-text",class:"upload-icon"}),t[110]||(t[110]=(0,i.Lk)("div",{class:"upload-text"},"å•æ–‡ä»¶é˜…è¯»",-1)),t[111]||(t[111]=(0,i.Lk)("div",{class:"upload-hint"},"é€‰æ‹©å•ä¸ª .jsonl æ–‡ä»¶",-1))])])),ti.loadingStatus?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",d,[(0,i.Lk)("input",{type:"file",ref:"zipInput",onChange:t[1]||(t[1]=(...e)=>si.handleZipUpload&&si.handleZipUpload(...e)),accept:".zip",id:"zip-input",class:"file-input"},null,544),(0,i.Lk)("label",h,[(0,i.bF)(ai,{icon:"bi:file-earmark-zip",class:"upload-icon"}),t[112]||(t[112]=(0,i.Lk)("div",{class:"upload-text"},"æ•°æ®ä»ªè¡¨ç›˜",-1)),t[113]||(t[113]=(0,i.Lk)("div",{class:"upload-hint"},"ä¸Šä¼  ZIP å‹ç¼©åŒ… Â· è§’è‰²åˆ†ç±» Â· ç»Ÿè®¡åˆ†æ",-1))])])),ti.loadingStatus?((0,i.uX)(),(0,i.CE)("div",g,[t[114]||(t[114]=(0,i.Lk)("div",{class:"spinner"},null,-1)),(0,i.eW)(" "+(0,o.v_)(ti.loadingStatus),1)])):(0,i.Q3)("",!0)])])):"dashboard"===ti.viewMode?((0,i.uX)(),(0,i.CE)("div",u,[(0,i.Lk)("div",p,[(0,i.Lk)("div",m,[(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>si.resetReader&&si.resetReader(...e)),class:"back-btn"},[(0,i.bF)(ai,{icon:"akar-icons:arrow-left"}),t[115]||(t[115]=(0,i.eW)(" è¿”å›é¦–é¡µ ",-1))]),(0,i.Lk)("div",v,[t[116]||(t[116]=(0,i.Lk)("h1",null,"æ•°æ®æ¡£æ¡ˆ",-1)),(0,i.Lk)("div",k," å…± "+(0,o.v_)(ti.dashboardData.totalFiles)+" ä¸ªæ–‡ä»¶ ",1)])])]),(0,i.Lk)("div",y,[(0,i.Lk)("div",b,[(0,i.Lk)("div",f,[(0,i.Lk)("div",x,(0,o.v_)(ti.dashboardData.totalEffectiveCN.toLocaleString()),1),t[117]||(t[117]=(0,i.Lk)("div",{class:"hero-label"},"æœ‰æ•ˆæ±‰å­—æ€»æ•° (ä»…ä¾›å‚è€ƒ)",-1))]),t[121]||(t[121]=(0,i.Lk)("div",{class:"stat-divider"},null,-1)),(0,i.Lk)("div",S,[(0,i.Lk)("div",C,[(0,i.Lk)("div",L,(0,o.v_)(Object.keys(ti.dashboardData.groups).length),1),t[118]||(t[118]=(0,i.Lk)("div",{class:"sub-label"},"è§’è‰²æ•°é‡",-1))]),(0,i.Lk)("div",F,[(0,i.Lk)("div",w,(0,o.v_)(ti.dashboardData.totalTurns.toLocaleString()),1),t[119]||(t[119]=(0,i.Lk)("div",{class:"sub-label"},"æ€»å¯¹è¯æ¥¼å±‚",-1))]),(0,i.Lk)("div",M,[(0,i.Lk)("div",T,(0,o.v_)(ti.dashboardData.totalRerolls.toLocaleString()),1),t[120]||(t[120]=(0,i.Lk)("div",{class:"sub-label"},"é‡Rollæ¬¡æ•°",-1))])])]),ti.dashboardCalendar.months.length>0?((0,i.uX)(),(0,i.CE)("div",D,[(0,i.Lk)("div",I,[(0,i.Lk)("div",E,[(0,i.bF)(ai,{icon:"bi:calendar-check"}),t[122]||(t[122]=(0,i.eW)(" é…’é¦†æ—¥è®° ",-1))]),(0,i.Lk)("div",_," æ´»è·ƒ "+(0,o.v_)(ti.dashboardCalendar.activeDays)+" å¤© Â· ç´¯è®¡ "+(0,o.v_)(ti.dashboardCalendar.totalMessages)+" æ¡æ¶ˆæ¯ ",1)]),(0,i.Lk)("div",P,[(0,i.Lk)("div",R,[(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>si.prevDashMonth&&si.prevDashMonth(...e)),disabled:ti.dashboardCalendar.currentMonthIdx>=ti.dashboardCalendar.months.length-1,class:"nav-btn"},"â—€",8,N),(0,i.Lk)("div",$,(0,o.v_)(ti.dashboardCalendar.months[ti.dashboardCalendar.currentMonthIdx].year)+"å¹´ "+(0,o.v_)(ti.dashboardCalendar.months[ti.dashboardCalendar.currentMonthIdx].month)+"æœˆ ",1),(0,i.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>si.nextDashMonth&&si.nextDashMonth(...e)),disabled:ti.dashboardCalendar.currentMonthIdx<=0,class:"nav-btn"},"â–¶",8,X)]),(0,i.Lk)("div",O,[(0,i.Lk)("div",U,[t[123]||(t[123]=(0,i.Fv)('<div class="weekday-header" data-v-acde3a8e>æ—¥</div><div class="weekday-header" data-v-acde3a8e>ä¸€</div><div class="weekday-header" data-v-acde3a8e>äºŒ</div><div class="weekday-header" data-v-acde3a8e>ä¸‰</div><div class="weekday-header" data-v-acde3a8e>å››</div><div class="weekday-header" data-v-acde3a8e>äº”</div><div class="weekday-header" data-v-acde3a8e>å…­</div>',7)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.dashboardCalendar.months[ti.dashboardCalendar.currentMonthIdx].paddingStart,e=>((0,i.uX)(),(0,i.CE)("div",{key:"pad-"+e,class:"day-cell padding"}))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.dashboardCalendar.months[ti.dashboardCalendar.currentMonthIdx].days,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.dateStr,class:(0,o.C4)(["day-cell",{"has-data":e.count>0}]),style:(0,o.Tr)({backgroundColor:e.bgStyle}),onMouseenter:t=>si.showDayTooltip(t,e),onMouseleave:t[5]||(t[5]=(...e)=>si.hideDayTooltip&&si.hideDayTooltip(...e)),onMousemove:t[6]||(t[6]=e=>si.moveDayTooltip(e))},[(0,i.Lk)("span",A,(0,o.v_)(e.dayNum),1)],46,z))),128))])]),(0,i.Lk)("div",H,[(0,i.Lk)("div",W,[t[124]||(t[124]=(0,i.Lk)("span",{class:"f-label"},"æœ¬æœˆæ¶ˆæ¯",-1)),(0,i.Lk)("span",Q,(0,o.v_)(ti.dashboardCalendar.months[ti.dashboardCalendar.currentMonthIdx].totalCount.toLocaleString()),1)]),t[126]||(t[126]=(0,i.Lk)("div",{class:"footer-divider"},null,-1)),(0,i.Lk)("div",J,[t[125]||(t[125]=(0,i.Lk)("span",{class:"f-label"},"æœ¬æœˆå­—æ•°",-1)),(0,i.Lk)("span",j,(0,o.v_)(ti.dashboardCalendar.months[ti.dashboardCalendar.currentMonthIdx].totalChars.toLocaleString()),1)])])])])):(0,i.Q3)("",!0),(0,i.Lk)("div",V,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>ti.dashboardSearch=e),type:"text",placeholder:"æœç´¢è§’è‰²åæˆ–æ–‡ä»¶å...",class:"dash-search-input"},null,512),[[a.Jo,ti.dashboardSearch]])]),(0,i.Lk)("div",G,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(si.filteredDashboardGroups,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"char-group"},[(0,i.Lk)("div",B,[(0,i.Lk)("div",Y,[(0,i.Lk)("div",q,[(0,i.bF)(ai,{icon:"bxs:user",class:"char-icon"}),(0,i.eW)(" "+(0,o.v_)(t),1)]),(0,i.Lk)("div",K,(0,o.v_)(e.length)+" ä¸ªä¼šè¯ Â· "+(0,o.v_)(e.reduce((e,t)=>e+t.effectiveCN,0).toLocaleString())+" å­— ",1)]),(0,i.Lk)("button",{onClick:(0,a.D$)(s=>si.openDashboardIntimacy(t,e),["stop"]),class:"action-button intimacy-btn icon-only-btn",title:"æŸ¥çœ‹äº²å¯†åº¦"},[(0,i.bF)(ai,{icon:"bxs:heart",class:"heart-icon"})],8,Z)]),(0,i.Lk)("div",ee,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.fileName,class:"file-card",onClick:t=>si.openChatFromDashboard(e)},[(0,i.Lk)("div",se,[(0,i.Lk)("div",{class:"file-name",title:e.fileName},(0,o.v_)(e.fileName),9,ae),(0,i.Lk)("div",ie,[(0,i.Lk)("span",oe,(0,o.v_)(e.effectiveCN.toLocaleString())+" å­—",1),(0,i.Lk)("span",ne,(0,o.v_)(e.totalTurns)+" æ¥¼",1)])]),(0,i.Lk)("div",le,(0,o.v_)(e.lastDate),1)],8,te))),128))])]))),128))])])])):((0,i.uX)(),(0,i.CE)("div",re,[(0,i.Lk)("div",ce,[(0,i.Lk)("div",de,[ti.fromDashboard?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t[8]||(t[8]=(...e)=>si.backToDashboard&&si.backToDashboard(...e)),class:"back-link-btn"},[(0,i.bF)(ai,{icon:"akar-icons:arrow-left"}),t[127]||(t[127]=(0,i.eW)(" è¿”å›åˆ—è¡¨ ",-1))])):(0,i.Q3)("",!0),(0,i.Lk)("h1",he,(0,o.v_)(ti.metadata.character_name||"èŠå¤©è®°å½•"),1),(0,i.Lk)("div",ge,[ti.metadata.create_date?((0,i.uX)(),(0,i.CE)("span",ue,(0,o.v_)(ti.metadata.create_date),1)):(0,i.Q3)("",!0),(0,i.Lk)("span",pe,(0,o.v_)(ti.messages.length)+" æ¡æ¶ˆæ¯",1)])]),(0,i.Lk)("div",me,[(0,i.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>si.toggleSearchBar&&si.toggleSearchBar(...e)),class:(0,o.C4)(["action-button","search-toggle",{active:ti.showSearchBar}])}," æœç´¢ ",2),(0,i.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>si.toggleTagFilterManager&&si.toggleTagFilterManager(...e)),class:(0,o.C4)(["action-button",{active:ti.showTagFilterManager}])},[t[128]||(t[128]=(0,i.eW)(" æ ‡ç­¾è¿‡æ»¤ ",-1)),ti.tagFilters.length?((0,i.uX)(),(0,i.CE)("span",ve,"("+(0,o.v_)(ti.tagFilters.filter(e=>!e.disabled).length)+")",1)):(0,i.Q3)("",!0)],2),(0,i.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>si.toggleRegexManager&&si.toggleRegexManager(...e)),class:"action-button regex-button"},[t[129]||(t[129]=(0,i.eW)(" æ­£åˆ™è„šæœ¬ ",-1)),ti.regexScripts.length?((0,i.uX)(),(0,i.CE)("span",ke,"("+(0,o.v_)(ti.regexScripts.filter(e=>!e.disabled).length)+")",1)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",ye,[(0,i.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>si.toggleFavoritesPanel&&si.toggleFavoritesPanel(...e)),class:(0,o.C4)(["action-button",{active:ti.showFavoritesPanel}])},[t[130]||(t[130]=(0,i.eW)(" æ”¶è—å¤¹ ",-1)),ti.favorites.length?((0,i.uX)(),(0,i.CE)("span",be,"("+(0,o.v_)(ti.favorites.length)+")",1)):(0,i.Q3)("",!0)],2),(0,i.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>si.openIntimacyModal&&si.openIntimacyModal(...e)),class:"action-button intimacy-btn"},[(0,i.bF)(ai,{icon:"bxs:heart",class:"heart-icon"}),t[131]||(t[131]=(0,i.eW)(" äº²å¯†åº¦ ",-1))]),(0,i.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>si.toggleReadingMode&&si.toggleReadingMode(...e)),class:(0,o.C4)(["action-button","reading-mode-btn",{active:ti.readingMode}])}," é˜…è¯»æ¨¡å¼ ",2),(0,i.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>si.openExportRangeDialog&&si.openExportRangeDialog(...e)),class:"action-button"}," å¯¼å‡º ")]),(0,i.Lk)("button",{onClick:t[16]||(t[16]=(...e)=>si.toggleStylePanel&&si.toggleStylePanel(...e)),class:(0,o.C4)(["action-button",{active:ti.showStylePanel}])}," æ ·å¼ ",2),(0,i.Lk)("button",{onClick:t[17]||(t[17]=(...e)=>si.toggleDarkMode&&si.toggleDarkMode(...e)),class:"action-button mode-toggle"},[(0,i.Lk)("div",fe,[ti.isDarkMode?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.bF)(ai,{icon:"heroicons-solid:sun",class:"mode-icon sun"}),t[132]||(t[132]=(0,i.Lk)("span",null,"æ—¥é—´",-1))],64)):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(ai,{icon:"bxs:moon",class:"mode-icon moon"}),t[133]||(t[133]=(0,i.Lk)("span",null,"å¤œé—´",-1))],64))])]),(0,i.Lk)("button",{onClick:t[18]||(t[18]=(...e)=>si.resetReader&&si.resetReader(...e)),class:"reset-button"},"å…³é—­")])]),ti.showSearchBar?((0,i.uX)(),(0,i.CE)("div",xe,[(0,i.Lk)("div",Se,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>ti.searchQuery=e),onInput:t[20]||(t[20]=(...e)=>si.onSearchInput&&si.onSearchInput(...e)),type:"text",class:"search-input",placeholder:"æœç´¢æ¶ˆæ¯å†…å®¹æˆ–å‘è¨€è€…..."},null,544),[[a.Jo,ti.searchQuery]]),ti.searchQuery?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:t[21]||(t[21]=(...e)=>si.clearSearch&&si.clearSearch(...e)),class:"search-clear",title:"æ¸…é™¤"},"âœ•")):(0,i.Q3)("",!0)]),(0,i.Lk)("div",Ce,[ti.searchQuery?((0,i.uX)(),(0,i.CE)("span",Le," æ‰¾åˆ° "+(0,o.v_)(si.filteredMessages.length)+" æ¡åŒ¹é… ",1)):(0,i.Q3)("",!0)])])):(0,i.Q3)("",!0),ti.showTagFilterManager?((0,i.uX)(),(0,i.CE)("div",Fe,[(0,i.Lk)("div",we,[t[134]||(t[134]=(0,i.Lk)("h2",null,"æ ‡ç­¾è¿‡æ»¤ï¼ˆä¼˜å…ˆäºæ­£åˆ™ï¼‰",-1)),(0,i.Lk)("div",Me,[(0,i.Lk)("button",{onClick:t[22]||(t[22]=(...e)=>si.addNewTagFilter&&si.addNewTagFilter(...e)),class:"btn btn-primary"},"æ·»åŠ è¿‡æ»¤")])]),ti.tagFilterForm.id?((0,i.uX)(),(0,i.CE)("div",Te,[(0,i.Lk)("div",De,[t[135]||(t[135]=(0,i.Lk)("label",null,"è¿‡æ»¤å™¨åç§°",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[23]||(t[23]=e=>ti.tagFilterForm.name=e),type:"text",placeholder:"å¦‚ï¼šç§»é™¤æ€ç»´é“¾"},null,512),[[a.Jo,ti.tagFilterForm.name]])]),(0,i.Lk)("div",Ie,[t[136]||(t[136]=(0,i.Lk)("label",null,"æ ‡ç­¾åï¼ˆä¸å«å°–æ‹¬å·ï¼‰",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[24]||(t[24]=e=>ti.tagFilterForm.tagName=e),type:"text",placeholder:"å¦‚ï¼šthink æˆ– thinking"},null,512),[[a.Jo,ti.tagFilterForm.tagName]]),t[137]||(t[137]=(0,i.Lk)("div",{class:"form-hint"},"æ”¯æŒå¤šä¸ªæ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šthink,thinking,disclaimer",-1))]),(0,i.Lk)("div",Ee,[t[139]||(t[139]=(0,i.Lk)("label",null,"è¿‡æ»¤æ¨¡å¼",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[25]||(t[25]=e=>ti.tagFilterForm.mode=e),class:"form-select"},[...t[138]||(t[138]=[(0,i.Lk)("option",{value:"remove"},"åˆ é™¤è¿™äº›æ ‡ç­¾åŠå…¶å†…å®¹",-1),(0,i.Lk)("option",{value:"keep"},"åªä¿ç•™è¿™äº›æ ‡ç­¾å†…çš„å†…å®¹",-1),(0,i.Lk)("option",{value:"unwrap"},"ç§»é™¤æ ‡ç­¾ä½†ä¿ç•™å†…å®¹",-1)])],512),[[a.u1,ti.tagFilterForm.mode]])]),(0,i.Lk)("div",_e,[(0,i.Lk)("label",null,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[26]||(t[26]=e=>ti.tagFilterForm.disabled=e),type:"checkbox"},null,512),[[a.lH,ti.tagFilterForm.disabled]]),t[140]||(t[140]=(0,i.eW)(" ç¦ç”¨æ­¤è¿‡æ»¤å™¨ ",-1))])]),(0,i.Lk)("div",Pe,[(0,i.Lk)("button",{onClick:t[27]||(t[27]=(...e)=>si.cancelEditTagFilter&&si.cancelEditTagFilter(...e)),class:"btn btn-secondary"},"å–æ¶ˆ"),(0,i.Lk)("button",{onClick:t[28]||(t[28]=(...e)=>si.saveTagFilter&&si.saveTagFilter(...e)),class:"btn btn-primary"},"ä¿å­˜")])])):(0,i.Q3)("",!0),(0,i.Lk)("div",Re,[ti.tagFilters.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Ne,' æš‚æ— æ ‡ç­¾è¿‡æ»¤å™¨ï¼Œç‚¹å‡»"æ·»åŠ è¿‡æ»¤"æ¥åˆ›å»º ')),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.tagFilters,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:(0,o.C4)(["script-item",{disabled:e.disabled}])},[(0,i.Lk)("div",$e,[(0,i.Lk)("div",Xe,(0,o.v_)(e.name),1),(0,i.Lk)("div",Oe,(0,o.v_)("remove"===e.mode?"åˆ é™¤":"keep"===e.mode?"åªä¿ç•™":"è§£åŒ…")+": <"+(0,o.v_)(e.tagName)+"> ",1)]),(0,i.Lk)("div",Ue,[(0,i.Lk)("button",{onClick:e=>si.moveTagFilterUp(t),disabled:0===t,class:"btn-icon",title:"ä¸Šç§»"},"â†‘",8,ze),(0,i.Lk)("button",{onClick:e=>si.moveTagFilterDown(t),disabled:t===ti.tagFilters.length-1,class:"btn-icon",title:"ä¸‹ç§»"},"â†“",8,Ae),(0,i.Lk)("button",{onClick:t=>si.toggleTagFilter(e),class:(0,o.C4)(["btn-toggle",{active:!e.disabled}])},(0,o.v_)(e.disabled?"å·²ç¦ç”¨":"å·²å¯ç”¨"),11,He),(0,i.Lk)("button",{onClick:t=>si.editTagFilter(e),class:"btn-icon",title:"ç¼–è¾‘"},"âœ",8,We),(0,i.Lk)("button",{onClick:t=>si.deleteTagFilter(e.id),class:"btn-icon btn-danger",title:"åˆ é™¤"},"âœ•",8,Qe)])],2))),128))])])):(0,i.Q3)("",!0),ti.showRegexManager?((0,i.uX)(),(0,i.CE)("div",Je,[(0,i.Lk)("div",je,[t[141]||(t[141]=(0,i.Lk)("h2",null,"æ­£åˆ™è„šæœ¬ç®¡ç†",-1)),(0,i.Lk)("div",Ve,[(0,i.Lk)("button",{onClick:t[29]||(t[29]=(...e)=>si.importScripts&&si.importScripts(...e)),class:"btn btn-secondary"},"å¯¼å…¥æ­£åˆ™"),(0,i.Lk)("button",{onClick:t[30]||(t[30]=(...e)=>si.importFromCardOrPreset&&si.importFromCardOrPreset(...e)),class:"btn btn-secondary"},"ä»è§’è‰²å¡/é¢„è®¾å¯¼å…¥"),(0,i.Lk)("button",{onClick:t[31]||(t[31]=(...e)=>si.exportScripts&&si.exportScripts(...e)),class:"btn btn-secondary",disabled:!ti.regexScripts.length},"å¯¼å‡º",8,Ge),(0,i.Lk)("button",{onClick:t[32]||(t[32]=(...e)=>si.addNewScript&&si.addNewScript(...e)),class:"btn btn-primary"},"æ·»åŠ è„šæœ¬")])]),ti.scriptForm.id?((0,i.uX)(),(0,i.CE)("div",Be,[(0,i.Lk)("div",Ye,[t[142]||(t[142]=(0,i.Lk)("label",null,"è„šæœ¬åç§°",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[33]||(t[33]=e=>ti.scriptForm.scriptName=e),type:"text",placeholder:"å¦‚ï¼šç§»é™¤æ€ç»´é“¾å†…å®¹"},null,512),[[a.Jo,ti.scriptForm.scriptName]])]),(0,i.Lk)("div",qe,[t[143]||(t[143]=(0,i.Lk)("label",null,"æ­£åˆ™è¡¨è¾¾å¼",-1)),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[34]||(t[34]=e=>ti.scriptForm.findRegex=e),placeholder:"å¦‚ï¼š/(<think>[\\s\\S]*?</think>)/gs",rows:"3"},null,512),[[a.Jo,ti.scriptForm.findRegex]]),t[144]||(t[144]=(0,i.Lk)("div",{class:"form-hint"},"æ”¯æŒæ ¼å¼ï¼š/pattern/flags æˆ–ç›´æ¥è¾“å…¥æ¨¡å¼ï¼ˆé»˜è®¤æ·»åŠ  g æ ‡å¿—ï¼‰",-1))]),(0,i.Lk)("div",Ke,[t[145]||(t[145]=(0,i.Lk)("label",null,"æ›¿æ¢å†…å®¹",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[35]||(t[35]=e=>ti.scriptForm.replaceString=e),type:"text",placeholder:"ç•™ç©ºè¡¨ç¤ºåˆ é™¤åŒ¹é…å†…å®¹"},null,512),[[a.Jo,ti.scriptForm.replaceString]])]),(0,i.Lk)("div",Ze,[(0,i.Lk)("label",null,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[36]||(t[36]=e=>ti.scriptForm.disabled=e),type:"checkbox"},null,512),[[a.lH,ti.scriptForm.disabled]]),t[146]||(t[146]=(0,i.eW)(" ç¦ç”¨æ­¤è„šæœ¬ ",-1))])]),(0,i.Lk)("div",et,[(0,i.Lk)("button",{onClick:t[37]||(t[37]=(...e)=>si.cancelEdit&&si.cancelEdit(...e)),class:"btn btn-secondary"},"å–æ¶ˆ"),(0,i.Lk)("button",{onClick:t[38]||(t[38]=(...e)=>si.saveScript&&si.saveScript(...e)),class:"btn btn-primary"},"ä¿å­˜")])])):(0,i.Q3)("",!0),(0,i.Lk)("div",tt,[ti.regexScripts.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",st,' æš‚æ— æ­£åˆ™è„šæœ¬ï¼Œç‚¹å‡»"æ·»åŠ è„šæœ¬"æˆ–"å¯¼å…¥"æ¥åˆ›å»º ')),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.regexScripts,(e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:(0,o.C4)(["script-item",{disabled:e.disabled,dragging:ti.dragIndex===s}]),draggable:"true",onDragstart:e=>si.handleDragStart(s),onDragover:t[39]||(t[39]=(...e)=>si.handleDragOver&&si.handleDragOver(...e)),onDrop:e=>si.handleDrop(e,s),onDragend:t[40]||(t[40]=(...e)=>si.handleDragEnd&&si.handleDragEnd(...e))},[t[147]||(t[147]=(0,i.Lk)("div",{class:"script-drag-handle"},"â‹®â‹®",-1)),(0,i.Lk)("div",it,[(0,i.Lk)("div",ot,(0,o.v_)(e.scriptName),1),(0,i.Lk)("div",nt,(0,o.v_)(e.findRegex.substring(0,60))+(0,o.v_)(e.findRegex.length>60?"...":""),1)]),(0,i.Lk)("div",lt,[(0,i.Lk)("button",{onClick:e=>si.moveScriptUp(s),disabled:0===s,class:"btn-icon",title:"ä¸Šç§»"},"â†‘",8,rt),(0,i.Lk)("button",{onClick:e=>si.moveScriptDown(s),disabled:s===ti.regexScripts.length-1,class:"btn-icon",title:"ä¸‹ç§»"},"â†“",8,ct),(0,i.Lk)("button",{onClick:t=>si.toggleScript(e),class:(0,o.C4)(["btn-toggle",{active:!e.disabled}])},(0,o.v_)(e.disabled?"å·²ç¦ç”¨":"å·²å¯ç”¨"),11,dt),(0,i.Lk)("button",{onClick:t=>si.editScript(e),class:"btn-icon",title:"ç¼–è¾‘"},"âœ",8,ht),(0,i.Lk)("button",{onClick:t=>si.deleteScript(e.id),class:"btn-icon btn-danger",title:"åˆ é™¤"},"âœ•",8,gt)])],42,at))),128))])])):(0,i.Q3)("",!0),ti.showFavoritesPanel?((0,i.uX)(),(0,i.CE)("div",ut,[(0,i.Lk)("div",pt,[t[148]||(t[148]=(0,i.Lk)("h2",null,"æ”¶è—å¤¹",-1)),(0,i.Lk)("div",mt,[(0,i.Lk)("button",{onClick:t[41]||(t[41]=(...e)=>si.exportFavorites&&si.exportFavorites(...e)),class:"btn btn-secondary",disabled:!ti.favorites.length},"å¯¼å‡º",8,vt),(0,i.Lk)("button",{onClick:t[42]||(t[42]=(...e)=>si.clearAllFavorites&&si.clearAllFavorites(...e)),class:"btn btn-secondary",disabled:!ti.favorites.length},"æ¸…ç©º",8,kt)])]),(0,i.Lk)("div",yt,[ti.favorites.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",bt,' æš‚æ— æ”¶è—ï¼Œç‚¹å‡»æ¶ˆæ¯å³ä¸Šè§’çš„ â˜† æ”¶è—æ•´æ¡æ¶ˆæ¯ï¼Œæˆ–é€‰ä¸­æ–‡å­—åç‚¹å‡»"æ”¶è—" ')),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.favorites,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"favorite-item",onClick:t=>si.navigateToFavorite(e),title:"ç‚¹å‡»è·³è½¬åˆ°å¯¹åº”æ¥¼å±‚"},[(0,i.Lk)("div",xt,[(0,i.Lk)("div",St,["message"===e.type?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.bF)(ai,{icon:"icon-park-twotone:copy",style:{"vertical-align":"-2px"}}),t[149]||(t[149]=(0,i.eW)(" æ¥¼å±‚ ",-1))],64)):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(ai,{icon:"ri:draft-line",style:{"vertical-align":"-2px"}}),t[150]||(t[150]=(0,i.eW)(" å¥å­ ",-1))],64)),(0,i.eW)(" #"+(0,o.v_)(e.messageIndex+1),1)]),(0,i.Lk)("div",Ct,(0,o.v_)(e.text.substring(0,100))+(0,o.v_)(e.text.length>100?"...":""),1),(0,i.Lk)("div",Lt,[e.speaker?((0,i.uX)(),(0,i.CE)("span",Ft,(0,o.v_)(e.speaker),1)):(0,i.Q3)("",!0),(0,i.Lk)("span",null,(0,o.v_)(si.formatFavoriteTime(e.createdAt)),1)])]),(0,i.Lk)("div",wt,[(0,i.Lk)("button",{onClick:(0,a.D$)(t=>si.copyFavorite(e),["stop"]),class:"btn-icon",title:"å¤åˆ¶"},[(0,i.bF)(ai,{icon:"icon-park-twotone:copy",style:{"vertical-align":"-2px"}})],8,Mt),(0,i.Lk)("button",{onClick:(0,a.D$)(t=>si.deleteFavorite(e.id),["stop"]),class:"btn-icon btn-danger",title:"åˆ é™¤"},"âœ•",8,Tt)])],8,ft))),128))])])):(0,i.Q3)("",!0),ti.showStylePanel?((0,i.uX)(),(0,i.CE)("div",Dt,[(0,i.Lk)("div",It,[t[151]||(t[151]=(0,i.Lk)("h2",null,"æ­£æ–‡æ ·å¼è®¾ç½®",-1)),(0,i.Lk)("div",Et,[(0,i.Lk)("button",{onClick:t[43]||(t[43]=(...e)=>si.resetStyles&&si.resetStyles(...e)),class:"btn btn-secondary"},"æ¢å¤é»˜è®¤")])]),(0,i.Lk)("div",_t,[(0,i.Lk)("div",Pt,[t[153]||(t[153]=(0,i.Lk)("label",{class:"style-label"},"å­—ä½“è®¾ç½®",-1)),(0,i.Lk)("div",Rt,[(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[44]||(t[44]=e=>ti.textStyles.fontFamily=e),onChange:t[45]||(t[45]=(...e)=>si.saveStylesToStorage&&si.saveStylesToStorage(...e)),class:"style-select"},[t[152]||(t[152]=(0,i.Fv)('<optgroup label="ç³»ç»Ÿå­—ä½“" data-v-acde3a8e><option value="system" data-v-acde3a8e>ç³»ç»Ÿé»˜è®¤</option><option value="serif" data-v-acde3a8e>å®‹ä½“ / è¡¬çº¿ä½“</option><option value="sans-serif" data-v-acde3a8e>é»‘ä½“ / æ— è¡¬çº¿ä½“</option><option value="kaiti" data-v-acde3a8e>æ¥·ä½“</option><option value="fangsong" data-v-acde3a8e>ä»¿å®‹</option><option value="monospace" data-v-acde3a8e>ç­‰å®½å­—ä½“</option></optgroup><optgroup label="åœ¨çº¿å­—ä½“" data-v-acde3a8e><option value="alegreya" data-v-acde3a8e>Alegreya</option><option value="cangeryunhei" data-v-acde3a8e>ä»“è€³äº‘é»‘</option><option value="huiwenmingchao" data-v-acde3a8e>æ±‡æ–‡æ˜æœ</option><option value="kongmingchao" data-v-acde3a8e>ç©ºæ˜æœï¼ˆç¹ä½“/æ—¥æ–‡ï¼‰</option><option value="pingxianzhensong" data-v-acde3a8e>å±æ˜¾è‡»å®‹</option><option value="wenyueminguofangsong" data-v-acde3a8e>æ–‡æ‚¦æ°‘å›½ä»¿å®‹</option></optgroup>',2)),ti.customFonts.length?((0,i.uX)(),(0,i.CE)("optgroup",Nt,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.customFonts,e=>((0,i.uX)(),(0,i.CE)("option",{key:e.id,value:"custom-"+e.id},(0,o.v_)(e.name),9,$t))),128))])):(0,i.Q3)("",!0)],544),[[a.u1,ti.textStyles.fontFamily]]),(0,i.Lk)("button",{onClick:t[46]||(t[46]=e=>ti.showCustomFontDialog=!0),class:"btn btn-secondary btn-sm compact-btn",title:"å¯¼å…¥å­—ä½“"}," + å¯¼å…¥ ")])]),(0,i.Lk)("div",Xt,[(0,i.Lk)("div",Ot,[(0,i.Lk)("label",Ut,"å­—å· / "+(0,o.v_)(ti.textStyles.fontSize)+"px",1),(0,i.bo)((0,i.Lk)("input",{type:"range","onUpdate:modelValue":t[47]||(t[47]=e=>ti.textStyles.fontSize=e),onInput:t[48]||(t[48]=(...e)=>si.handleStyleChange&&si.handleStyleChange(...e)),min:"12",max:"32",step:"1",class:"style-slider"},null,544),[[a.Jo,ti.textStyles.fontSize,void 0,{number:!0}]])]),(0,i.Lk)("div",zt,[(0,i.Lk)("label",At,"è¡Œé«˜ / "+(0,o.v_)(ti.textStyles.lineHeight.toFixed(1)),1),(0,i.bo)((0,i.Lk)("input",{type:"range","onUpdate:modelValue":t[49]||(t[49]=e=>ti.textStyles.lineHeight=e),onInput:t[50]||(t[50]=(...e)=>si.handleStyleChange&&si.handleStyleChange(...e)),min:"1.2",max:"3",step:"0.1",class:"style-slider"},null,544),[[a.Jo,ti.textStyles.lineHeight,void 0,{number:!0}]])]),(0,i.Lk)("div",Ht,[(0,i.Lk)("label",Wt,"æ®µè· / "+(0,o.v_)(ti.textStyles.paragraphSpacing.toFixed(1))+"em",1),(0,i.bo)((0,i.Lk)("input",{type:"range","onUpdate:modelValue":t[51]||(t[51]=e=>ti.textStyles.paragraphSpacing=e),onInput:t[52]||(t[52]=(...e)=>si.handleStyleChange&&si.handleStyleChange(...e)),min:"0",max:"2",step:"0.1",class:"style-slider"},null,544),[[a.Jo,ti.textStyles.paragraphSpacing,void 0,{number:!0}]])]),(0,i.Lk)("div",Qt,[(0,i.Lk)("label",Jt,"å­—è· / "+(0,o.v_)(ti.textStyles.letterSpacing)+"px",1),(0,i.bo)((0,i.Lk)("input",{type:"range","onUpdate:modelValue":t[53]||(t[53]=e=>ti.textStyles.letterSpacing=e),onInput:t[54]||(t[54]=(...e)=>si.handleStyleChange&&si.handleStyleChange(...e)),min:"-2",max:"10",step:"0.5",class:"style-slider"},null,544),[[a.Jo,ti.textStyles.letterSpacing,void 0,{number:!0}]])])]),t[159]||(t[159]=(0,i.Lk)("hr",{class:"style-divider"},null,-1)),(0,i.Lk)("div",jt,[(0,i.Lk)("div",Vt,[t[154]||(t[154]=(0,i.Lk)("label",{class:"style-label"},"ä¸»è¦æ–‡æœ¬",-1)),(0,i.Lk)("div",Gt,[(0,i.bo)((0,i.Lk)("input",{type:"color","onUpdate:modelValue":t[55]||(t[55]=e=>ti.textStyles.textColor=e),onChange:t[56]||(t[56]=(...e)=>si.saveStylesToStorage&&si.saveStylesToStorage(...e)),class:"color-input"},null,544),[[a.Jo,ti.textStyles.textColor]]),(0,i.Lk)("span",Bt,(0,o.v_)(ti.textStyles.textColor),1)])]),(0,i.Lk)("div",Yt,[t[155]||(t[155]=(0,i.Lk)("label",{class:"style-label"},"æ–œä½“ (*text*)",-1)),(0,i.Lk)("div",qt,[(0,i.bo)((0,i.Lk)("input",{type:"color","onUpdate:modelValue":t[57]||(t[57]=e=>ti.textStyles.italicColor=e),onChange:t[58]||(t[58]=(...e)=>si.saveStylesToStorage&&si.saveStylesToStorage(...e)),class:"color-input"},null,544),[[a.Jo,ti.textStyles.italicColor]]),(0,i.Lk)("span",Kt,(0,o.v_)(ti.textStyles.italicColor),1)])]),(0,i.Lk)("div",Zt,[t[156]||(t[156]=(0,i.Lk)("label",{class:"style-label"},"ä¸‹åˆ’çº¿ (<u>)",-1)),(0,i.Lk)("div",es,[(0,i.bo)((0,i.Lk)("input",{type:"color","onUpdate:modelValue":t[59]||(t[59]=e=>ti.textStyles.underlineColor=e),onChange:t[60]||(t[60]=(...e)=>si.saveStylesToStorage&&si.saveStylesToStorage(...e)),class:"color-input"},null,544),[[a.Jo,ti.textStyles.underlineColor]]),(0,i.Lk)("span",ts,(0,o.v_)(ti.textStyles.underlineColor),1)])]),(0,i.Lk)("div",ss,[t[157]||(t[157]=(0,i.Lk)("label",{class:"style-label"},"å¼•ç”¨ ( > )",-1)),(0,i.Lk)("div",as,[(0,i.bo)((0,i.Lk)("input",{type:"color","onUpdate:modelValue":t[61]||(t[61]=e=>ti.textStyles.quoteColor=e),onChange:t[62]||(t[62]=(...e)=>si.saveStylesToStorage&&si.saveStylesToStorage(...e)),class:"color-input"},null,544),[[a.Jo,ti.textStyles.quoteColor]]),(0,i.Lk)("span",is,(0,o.v_)(ti.textStyles.quoteColor),1)])])]),t[160]||(t[160]=(0,i.Lk)("hr",{class:"style-divider"},null,-1)),(0,i.Lk)("div",os,[t[158]||(t[158]=(0,i.Lk)("label",{class:"style-label"},"å¯¹é½æ–¹å¼",-1)),(0,i.Lk)("div",ns,[(0,i.Lk)("button",{onClick:t[63]||(t[63]=e=>si.setTextAlign("left")),class:(0,o.C4)(["align-btn",{active:"left"===ti.textStyles.textAlign}]),title:"å·¦å¯¹é½"},"â—§",2),(0,i.Lk)("button",{onClick:t[64]||(t[64]=e=>si.setTextAlign("justify")),class:(0,o.C4)(["align-btn",{active:"justify"===ti.textStyles.textAlign}]),title:"ä¸¤ç«¯å¯¹é½"},"â–£",2),(0,i.Lk)("button",{onClick:t[65]||(t[65]=e=>si.setTextAlign("center")),class:(0,o.C4)(["align-btn",{active:"center"===ti.textStyles.textAlign}]),title:"å±…ä¸­"},"â—«",2)])])]),(0,i.Lk)("div",ls,[t[162]||(t[162]=(0,i.Lk)("div",{class:"style-preview-label"},"é¢„è§ˆæ•ˆæœï¼š",-1)),(0,i.Lk)("div",{class:"style-preview-content",style:(0,o.Tr)(si.getPreviewStyles())},[...t[161]||(t[161]=[(0,i.Lk)("p",null," è¿™æ˜¯ä¸€æ®µä¸»è¦æ–‡æœ¬ã€‚é€šå¸¸ç”¨äºæå†™ç¯å¢ƒã€åŠ¨ä½œæˆ–æ˜¯æ­£å¸¸çš„å¯¹è¯å†…å®¹ã€‚ä½ å¯ä»¥é€šè¿‡è¿™æ®µæ–‡å­—æ¥ç¡®è®¤åŸºç¡€å­—è‰²æ˜¯å¦ç¬¦åˆä½ çš„é˜…è¯»ä¹ æƒ¯ã€‚ ",-1),(0,i.Lk)("p",null,[(0,i.Lk)("em",null,"*è¿™æ˜¯ä¸€æ®µæ–œä½“æ–‡æœ¬ã€‚åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œå®ƒè¢«ç”¨æ¥è¡¨ç°è§’è‰²çš„å†…å¿ƒç‹¬ç™½ã€æ½œæ„è¯†çš„æƒ³æ³•ï¼Œæˆ–è€…ä»…ä»…æ˜¯ä¸ºäº†è¡¨ç¤ºæŸç§ç‰¹æ®Šçš„å¼ºè°ƒè¯­æ°”ã€‚*")],-1),(0,i.Lk)("p",null,[(0,i.eW)(" æ¥ç€æ˜¯ç‰¹æ®Šçš„æ ‡è®°å†…å®¹ï¼Œè¯·æ³¨æ„è¿™é‡Œæœ‰ä¸€æ®µ "),(0,i.Lk)("u",null,"ä¸‹åˆ’çº¿æ–‡æœ¬"),(0,i.eW)("ã€‚è¿™ç§æ ¼å¼å¸¸ç”¨äºä¿¡ä»¶ä¸­çš„é‡ç‚¹ã€å‘Šç¤ºç‰Œä¸Šçš„æ–‡å­—ï¼Œæˆ–è€…ç‰¹æ®Šçš„çº¿ç´¢æç¤ºã€‚ ")],-1),(0,i.Lk)("blockquote",null,[(0,i.eW)(" â€œè¿™æ˜¯ä¸€æ®µå¼•ç”¨æ–‡æœ¬ã€‚"),(0,i.Lk)("br"),(0,i.eW)(" å®ƒé€šå¸¸ç”¨äºå±•ç¤ºä¹¦ä¿¡å†…å®¹ã€å›å¿†çš„ç‰‡æ®µã€ä¹¦ç±æ‘˜å½•æˆ–è€…æ˜¯è¯—æ­Œã€‚"),(0,i.Lk)("br"),(0,i.eW)(" è¯·æ£€æŸ¥è¿™æ®µæ–‡å­—çš„é¢œè‰²ä»¥åŠå·¦ä¾§å¼•ç”¨çº¿çš„é¢œè‰²æ˜¯å¦æ¸…æ™°ã€‚â€ ")],-1)])],4)]),ti.customFonts.length?((0,i.uX)(),(0,i.CE)("div",rs,[t[163]||(t[163]=(0,i.Lk)("div",{class:"style-label"},"å·²å¯¼å…¥çš„è‡ªå®šä¹‰å­—ä½“",-1)),(0,i.Lk)("div",cs,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.customFonts,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.id,class:"custom-font-item"},[(0,i.Lk)("span",ds,(0,o.v_)(e.name),1),(0,i.Lk)("button",{onClick:t=>si.deleteCustomFont(e.id),class:"btn-icon btn-danger",title:"åˆ é™¤"},"âœ•",8,hs)]))),128))])])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0),ti.showCustomFontDialog?((0,i.uX)(),(0,i.CE)("div",{key:5,class:"modal-overlay",onClick:t[72]||(t[72]=(0,a.D$)(e=>ti.showCustomFontDialog=!1,["self"]))},[(0,i.Lk)("div",gs,[(0,i.Lk)("div",us,[t[164]||(t[164]=(0,i.Lk)("h3",null,"å¯¼å…¥è‡ªå®šä¹‰å­—ä½“",-1)),(0,i.Lk)("button",{onClick:t[66]||(t[66]=e=>ti.showCustomFontDialog=!1),class:"modal-close"},"âœ•")]),(0,i.Lk)("div",ps,[(0,i.Lk)("div",ms,[t[165]||(t[165]=(0,i.Lk)("label",null,[(0,i.eW)("å­—ä½“åç§° "),(0,i.Lk)("span",{class:"required"},"*")],-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[67]||(t[67]=e=>ti.customFontForm.name=e),type:"text",placeholder:"ç»™å­—ä½“èµ·ä¸ªåå­—",class:"form-input"},null,512),[[a.Jo,ti.customFontForm.name]])]),(0,i.Lk)("div",vs,[(0,i.Lk)("div",ks,[t[166]||(t[166]=(0,i.Lk)("div",{class:"import-method-header"},"æ–¹å¼ä¸€ï¼šä»URLå¯¼å…¥",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[68]||(t[68]=e=>ti.customFontForm.url=e),type:"text",placeholder:"è¾“å…¥å­—ä½“æ–‡ä»¶çš„URLï¼ˆæ”¯æŒ ttf/otf/woff/woff2ï¼‰",class:"form-input",disabled:!!ti.customFontForm.file},null,8,ys),[[a.Jo,ti.customFontForm.url]])]),t[168]||(t[168]=(0,i.Lk)("div",{class:"import-divider"},"æˆ–",-1)),(0,i.Lk)("div",bs,[t[167]||(t[167]=(0,i.Lk)("div",{class:"import-method-header"},"æ–¹å¼äºŒï¼šä»æ–‡ä»¶å¯¼å…¥",-1)),(0,i.Lk)("input",{ref:"fontFileInput",type:"file",accept:".ttf,.otf,.woff,.woff2",onChange:t[69]||(t[69]=(...e)=>si.handleFontFileSelect&&si.handleFontFileSelect(...e)),class:"form-file-input",disabled:!!ti.customFontForm.url},null,40,fs),ti.customFontForm.file?((0,i.uX)(),(0,i.CE)("div",xs," å·²é€‰æ‹©: "+(0,o.v_)(ti.customFontForm.file.name),1)):(0,i.Q3)("",!0)])]),t[169]||(t[169]=(0,i.Lk)("div",{class:"form-hint"},[(0,i.eW)(" æ”¯æŒçš„æ ¼å¼ï¼šTTFã€OTFã€WOFFã€WOFF2"),(0,i.Lk)("br"),(0,i.eW)(" æ³¨æ„ï¼šé€šè¿‡æ–‡ä»¶å¯¼å…¥çš„å­—ä½“ä¼šè½¬æ¢ä¸ºBase64å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ ")],-1))]),(0,i.Lk)("div",Ss,[(0,i.Lk)("button",{onClick:t[70]||(t[70]=(...e)=>si.resetCustomFontForm&&si.resetCustomFontForm(...e)),class:"btn btn-secondary"},"æ¸…ç©º"),(0,i.Lk)("button",{onClick:t[71]||(t[71]=(...e)=>si.addCustomFont&&si.addCustomFont(...e)),class:"btn btn-primary"},"å¯¼å…¥å­—ä½“")])])])):(0,i.Q3)("",!0),ti.highlightMenu.show?((0,i.uX)(),(0,i.CE)("div",{key:6,class:"highlight-menu",style:(0,o.Tr)({left:ti.highlightMenu.x+"px",top:ti.highlightMenu.y+"px"})},[(0,i.Lk)("button",{onClick:t[73]||(t[73]=(...e)=>si.removeHighlightFromMenu&&si.removeHighlightFromMenu(...e)),class:"selection-btn"},"âœ• å–æ¶ˆåˆ’çº¿")],4)):(0,i.Q3)("",!0),ti.readingMode?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",{key:7,class:"messages-wrapper",style:(0,o.Tr)(si.getContentStyles())},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(si.paginatedMessages,(e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:si.currentRange.start+s,class:(0,o.C4)(["message-block",{"user-message":e.is_user}])},[(0,i.Lk)("div",Cs,[(0,i.Lk)("span",Ls,(0,o.v_)(e.name),1),(0,i.Lk)("div",Fs,[e.send_date?((0,i.uX)(),(0,i.CE)("span",ws,(0,o.v_)(e.send_date),1)):(0,i.Q3)("",!0),e.model?((0,i.uX)(),(0,i.CE)("span",Ms,(0,o.v_)(e.model),1)):(0,i.Q3)("",!0),(0,i.Lk)("button",{onClick:t=>si.toggleFavoriteMessage(si.getGlobalMessageIndex(s),e),class:(0,o.C4)(["edit-btn",{favorited:si.isMessageFavorited(si.getGlobalMessageIndex(s))}]),title:si.isMessageFavorited(si.getGlobalMessageIndex(s))?"å–æ¶ˆæ”¶è—":"æ”¶è—æ¥¼å±‚"},(0,o.v_)(si.isMessageFavorited(si.getGlobalMessageIndex(s))?"â˜…":"â˜†"),11,Ts),(0,i.Lk)("button",{onClick:e=>si.toggleEditMessage(si.getGlobalMessageIndex(s)),class:"edit-btn",title:ti.editingMessageIndex===si.getGlobalMessageIndex(s)?"å–æ¶ˆç¼–è¾‘":"ç¼–è¾‘æ¶ˆæ¯"},(0,o.v_)(ti.editingMessageIndex===si.getGlobalMessageIndex(s)?"âœ•":"âœ"),9,Ds)])]),ti.editingMessageIndex===si.getGlobalMessageIndex(s)?((0,i.uX)(),(0,i.CE)("div",Is,[(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":t[74]||(t[74]=e=>ti.editingContent=e),class:"edit-textarea",rows:"10"},null,512),[[a.Jo,ti.editingContent]]),(0,i.Lk)("div",Es,[(0,i.Lk)("button",{onClick:t[75]||(t[75]=(...e)=>si.cancelEditMessage&&si.cancelEditMessage(...e)),class:"btn btn-secondary"},"å–æ¶ˆ"),(0,i.Lk)("button",{onClick:t[76]||(t[76]=(...e)=>si.saveEditMessage&&si.saveEditMessage(...e)),class:"btn btn-primary"},"ä¿å­˜")])])):(0,i.Q3)("",!0),ti.editingMessageIndex!==si.getGlobalMessageIndex(s)?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[si.hasHTMLCodeBlock(si.getMessageContent(e))?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"message-content-mixed",style:(0,o.Tr)(si.getContentStyles()),onMouseup:t=>si.handleTextSelection(t,si.getGlobalMessageIndex(s),e)},[(0,i.Lk)("div",{class:"message-content",style:(0,o.Tr)(si.getContentStyles()),innerHTML:si.renderContentWithHTMLPlaceholder(si.getMessageContent(e),si.getGlobalMessageIndex(s))},null,12,Ps)],44,_s)):si.isFullHTML(si.getMessageContent(e))?((0,i.uX)(),(0,i.CE)("div",Rs,[(0,i.Lk)("div",Ns,[t[170]||(t[170]=(0,i.Lk)("span",{class:"html-tag"},"HTML æ–‡æ¡£",-1)),(0,i.Lk)("button",{onClick:e=>si.toggleHTMLPreview(si.getGlobalMessageIndex(s)),class:"preview-toggle"},(0,o.v_)(e.showPreview?"éšè—é¢„è§ˆ":"æ˜¾ç¤ºé¢„è§ˆ"),9,$s)]),e.showPreview?((0,i.uX)(),(0,i.CE)("iframe",{key:0,srcdoc:si.getMessageContent(e),class:"html-iframe",sandbox:"allow-scripts allow-same-origin"},null,8,Xs)):((0,i.uX)(),(0,i.CE)("pre",Os,(0,o.v_)(si.getMessageContent(e)),1))])):((0,i.uX)(),(0,i.CE)("div",{key:2,class:"message-content",style:(0,o.Tr)(si.getContentStyles()),innerHTML:si.renderContent(si.getMessageContent(e),si.getGlobalMessageIndex(s)),onMouseup:t=>si.handleTextSelection(t,si.getGlobalMessageIndex(s),e)},null,44,Us))],64)):(0,i.Q3)("",!0),e.swipes&&e.swipes.length>1?((0,i.uX)(),(0,i.CE)("div",zs,[(0,i.Lk)("button",{onClick:e=>si.prevSwipe(si.getGlobalMessageIndex(s)),disabled:0===e.currentSwipeIndex,class:"swipe-btn",title:"ä¸Šä¸€æ¡"}," â—€ ",8,As),(0,i.Lk)("span",Hs,(0,o.v_)(e.currentSwipeIndex+1)+" / "+(0,o.v_)(e.swipes.length),1),(0,i.Lk)("button",{onClick:e=>si.nextSwipe(si.getGlobalMessageIndex(s)),disabled:e.currentSwipeIndex===e.swipes.length-1,class:"swipe-btn",title:"ä¸‹ä¸€æ¡"}," â–¶ ",8,Ws)])):(0,i.Q3)("",!0)],2))),128))],4)),ti.readingMode?((0,i.uX)(),(0,i.CE)("div",{key:8,class:"reading-view",ref:"readingView",onClick:t[86]||(t[86]=(...e)=>si.handleReadingClick&&si.handleReadingClick(...e))},[(0,i.Lk)("div",{class:"reading-content",ref:"readingContentEl",style:(0,o.Tr)(si.getReadingTransform()),innerHTML:ti.readingFullHtml,onMouseup:t[77]||(t[77]=(...e)=>si.onReadingMouseUp&&si.onReadingMouseUp(...e)),onTouchstart:t[78]||(t[78]=(...e)=>si.onReadingTouchStart&&si.onReadingTouchStart(...e)),onTouchend:t[79]||(t[79]=(...e)=>si.onReadingTouchEnd&&si.onReadingTouchEnd(...e))},null,44,Qs),(0,i.Lk)("div",{class:"reading-nav-left",onClick:t[80]||(t[80]=(...e)=>si.readingPrevPage&&si.readingPrevPage(...e))}),(0,i.Lk)("div",{class:"reading-nav-right",onClick:t[81]||(t[81]=(...e)=>si.readingNextPage&&si.readingNextPage(...e))}),(0,i.Lk)("div",{class:"reading-nav-center",onClick:t[82]||(t[82]=(...e)=>si.toggleToolbar&&si.toggleToolbar(...e))}),(0,i.Lk)("div",{class:(0,o.C4)(["reading-footer",{visible:ti.toolbarVisible}])},[(0,i.Lk)("div",Js,[(0,i.Lk)("span",null,(0,o.v_)(ti.readingCurrentPage)+" / "+(0,o.v_)(ti.readingTotalPages)+" é¡µ",1),(0,i.Lk)("span",js,"æ¥¼å±‚ "+(0,o.v_)(si.getReadingFloorRange()),1)]),(0,i.Lk)("div",Vs,[(0,i.Lk)("button",{onClick:t[83]||(t[83]=(...e)=>si.readingPrevPage&&si.readingPrevPage(...e)),disabled:ti.readingCurrentPage<=1,class:"reading-btn"},"â—€",8,Gs),(0,i.Lk)("button",{onClick:t[84]||(t[84]=(...e)=>si.toggleReadingMode&&si.toggleReadingMode(...e)),class:"reading-btn reading-exit"},"é€€å‡º"),(0,i.Lk)("button",{onClick:t[85]||(t[85]=(...e)=>si.readingNextPage&&si.readingNextPage(...e)),disabled:ti.readingCurrentPage>=ti.readingTotalPages,class:"reading-btn"},"â–¶",8,Bs)])],2)],512)):(0,i.Q3)("",!0),ti.readingMode?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Ys,[(0,i.Lk)("div",qs,[(0,i.eW)(" æ˜¾ç¤ºç¬¬ "+(0,o.v_)(si.currentRange.start)+"-"+(0,o.v_)(si.currentRange.end)+" æ¡ï¼Œå…± "+(0,o.v_)(si.filteredMessages.length)+" æ¡ ",1),ti.searchQuery?((0,i.uX)(),(0,i.CE)("span",Ks,"ï¼ˆå·²è¿‡æ»¤ï¼‰")):(0,i.Q3)("",!0)]),(0,i.Lk)("div",Zs,[(0,i.Lk)("button",{onClick:t[87]||(t[87]=e=>si.goToPage(1)),disabled:1===ti.currentPage,class:"page-btn",title:"é¦–é¡µ"},"âŸ¨âŸ¨",8,ea),(0,i.Lk)("button",{onClick:t[88]||(t[88]=(...e)=>si.prevPage&&si.prevPage(...e)),disabled:1===ti.currentPage,class:"page-btn",title:"ä¸Šä¸€é¡µ"},"âŸ¨",8,ta),(0,i.Lk)("span",sa,(0,o.v_)(ti.currentPage)+" / "+(0,o.v_)(si.totalPages),1),(0,i.Lk)("button",{onClick:t[89]||(t[89]=(...e)=>si.nextPage&&si.nextPage(...e)),disabled:ti.currentPage===si.totalPages,class:"page-btn",title:"ä¸‹ä¸€é¡µ"},"âŸ©",8,aa),(0,i.Lk)("button",{onClick:t[90]||(t[90]=e=>si.goToPage(si.totalPages)),disabled:ti.currentPage===si.totalPages,class:"page-btn",title:"æœ«é¡µ"},"âŸ©âŸ©",8,ia),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[91]||(t[91]=e=>ti.pageSize=e),onChange:t[92]||(t[92]=(...e)=>si.onPageSizeChange&&si.onPageSizeChange(...e)),class:"page-size-select"},[...t[171]||(t[171]=[(0,i.Lk)("option",{value:10},"10æ¡/é¡µ",-1),(0,i.Lk)("option",{value:20},"20æ¡/é¡µ",-1),(0,i.Lk)("option",{value:50},"50æ¡/é¡µ",-1),(0,i.Lk)("option",{value:100},"100æ¡/é¡µ",-1)])],544),[[a.u1,ti.pageSize,void 0,{number:!0}]])])]))])),ti.selectionMenu.show?((0,i.uX)(),(0,i.CE)("div",{key:3,class:"selection-menu",style:(0,o.Tr)({left:ti.selectionMenu.x+"px",top:ti.selectionMenu.y+"px"})},[(0,i.Lk)("button",{onClick:t[93]||(t[93]=(...e)=>si.favoriteSelectedText&&si.favoriteSelectedText(...e)),class:"selection-btn"},"â˜† æ”¶è—"),(0,i.Lk)("button",{onClick:t[94]||(t[94]=(...e)=>si.highlightSelectedText&&si.highlightSelectedText(...e)),class:"selection-btn"},"ğŸ– åˆ’çº¿"),(0,i.Lk)("button",{onClick:t[95]||(t[95]=(...e)=>si.copySelectedText&&si.copySelectedText(...e)),class:"selection-btn"},[(0,i.bF)(ai,{icon:"icon-park-twotone:copy",style:{"vertical-align":"-2px","margin-right":"2px"}}),t[172]||(t[172]=(0,i.eW)(" å¤åˆ¶ ",-1))])],4)):(0,i.Q3)("",!0),ti.exportDialog.show?((0,i.uX)(),(0,i.CE)("div",{key:4,class:"export-dialog-overlay",onClick:t[103]||(t[103]=(0,a.D$)((...e)=>si.closeExportDialog&&si.closeExportDialog(...e),["self"]))},[(0,i.Lk)("div",oa,[(0,i.Lk)("div",na,[t[173]||(t[173]=(0,i.Lk)("h3",null,"å¯¼å‡ºæ¥¼å±‚èŒƒå›´",-1)),(0,i.Lk)("button",{onClick:t[96]||(t[96]=(...e)=>si.closeExportDialog&&si.closeExportDialog(...e)),class:"btn-icon"},"âœ•")]),(0,i.Lk)("div",la,[(0,i.Lk)("div",ra,[(0,i.Lk)("div",ca,[(0,i.Lk)("div",da,[t[174]||(t[174]=(0,i.Lk)("label",null,"èµ·å§‹æ¥¼å±‚",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[97]||(t[97]=e=>ti.exportDialog.startFloor=e),min:1,max:si.filteredMessages.length,class:"range-input"},null,8,ha),[[a.Jo,ti.exportDialog.startFloor,void 0,{number:!0}]])]),t[176]||(t[176]=(0,i.Lk)("span",{class:"range-separator"},"è‡³",-1)),(0,i.Lk)("div",ga,[t[175]||(t[175]=(0,i.Lk)("label",null,"ç»“æŸæ¥¼å±‚",-1)),(0,i.bo)((0,i.Lk)("input",{type:"number","onUpdate:modelValue":t[98]||(t[98]=e=>ti.exportDialog.endFloor=e),min:1,max:si.filteredMessages.length,class:"range-input"},null,8,ua),[[a.Jo,ti.exportDialog.endFloor,void 0,{number:!0}]])])]),(0,i.Lk)("div",pa," å…± "+(0,o.v_)(si.filteredMessages.length)+" æ¡æ¶ˆæ¯ï¼Œå°†å¯¼å‡º "+(0,o.v_)(si.getExportCount())+" æ¡ ",1)]),(0,i.Lk)("div",ma,[(0,i.Lk)("label",va,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[99]||(t[99]=e=>ti.exportDialog.includeName=e)},null,512),[[a.lH,ti.exportDialog.includeName]]),t[177]||(t[177]=(0,i.eW)(" åŒ…å«å‘è¨€è€…åç§° ",-1))]),(0,i.Lk)("label",ka,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[100]||(t[100]=e=>ti.exportDialog.includeTime=e)},null,512),[[a.lH,ti.exportDialog.includeTime]]),t[178]||(t[178]=(0,i.eW)(" åŒ…å«å‘é€æ—¶é—´ ",-1))])]),(0,i.Lk)("div",ya,[t[179]||(t[179]=(0,i.Lk)("div",{class:"export-preview-label"},"é¢„è§ˆï¼ˆå‰ 3 æ¡ï¼‰ï¼š",-1)),(0,i.Lk)("pre",ba,(0,o.v_)(si.getExportPreview()),1)])]),(0,i.Lk)("div",fa,[(0,i.Lk)("button",{onClick:t[101]||(t[101]=(...e)=>si.closeExportDialog&&si.closeExportDialog(...e)),class:"btn btn-secondary"},"å–æ¶ˆ"),(0,i.Lk)("button",{onClick:t[102]||(t[102]=(...e)=>si.doExportRange&&si.doExportRange(...e)),class:"btn btn-primary"},"å¯¼å‡º TXT")])])])):(0,i.Q3)("",!0),ti.showIntimacyModal?((0,i.uX)(),(0,i.CE)("div",{key:5,class:"modal-overlay",onClick:t[109]||(t[109]=(0,a.D$)(e=>ti.showIntimacyModal=!1,["self"]))},[(0,i.Lk)("div",xa,[(0,i.Lk)("div",Sa,[(0,i.Lk)("h3",null,[(0,i.bF)(ai,{icon:"bxs:heart",style:{color:"#e91e63","margin-right":"8px"}}),t[180]||(t[180]=(0,i.eW)(" æƒ…æ„Ÿæ¡£æ¡ˆ ",-1))]),(0,i.Lk)("button",{onClick:t[104]||(t[104]=e=>ti.showIntimacyModal=!1),class:"modal-close"},"âœ•")]),(0,i.Lk)("div",Ca,[(0,i.Lk)("div",La,[(0,i.Lk)("div",Fa,[t[181]||(t[181]=(0,i.Lk)("div",{class:"stat-label"},"ç›¸è¯†æ—¥æœŸ",-1)),(0,i.Lk)("div",wa,(0,o.v_)(ti.intimacyData.firstDate||"N/A"),1),(0,i.Lk)("div",Ma,"è·ä»Š "+(0,o.v_)(ti.intimacyData.daysSince)+" å¤©",1)]),(0,i.Lk)("div",Ta,[t[183]||(t[183]=(0,i.Lk)("div",{class:"stat-label"},"æ´»è·ƒå¤©æ•°",-1)),(0,i.Lk)("div",Da,[(0,i.eW)((0,o.v_)(ti.intimacyData.activeDays)+" ",1),t[182]||(t[182]=(0,i.Lk)("span",{class:"unit"},"å¤©",-1))]),t[184]||(t[184]=(0,i.Lk)("div",{class:"stat-sub"},"ç´¯è®¡é™ªä¼´",-1))]),(0,i.Lk)("div",Ia,[t[185]||(t[185]=(0,i.Lk)("div",{class:"stat-label"},"æ¶ˆæ¯æ€»æ•°",-1)),(0,i.Lk)("div",Ea,(0,o.v_)(ti.intimacyData.totalMessages),1),(0,i.Lk)("div",_a,(0,o.v_)((ti.intimacyData.totalChars/1e4).toFixed(1))+"ä¸‡ å­—",1)]),(0,i.Lk)("div",Pa,[t[186]||(t[186]=(0,i.Lk)("div",{class:"stat-label"},"é‡Rollæ¬¡æ•°",-1)),(0,i.Lk)("div",Ra,(0,o.v_)(ti.intimacyData.totalRerolls),1),t[187]||(t[187]=(0,i.Lk)("div",{class:"stat-sub"},"å†ç©ºå›æˆªæ–­å…«è‚¡è¯•è¯•å‘¢",-1))])]),(0,i.Lk)("div",Na,[t[192]||(t[192]=(0,i.Fv)('<div class="calendar-header-row" data-v-acde3a8e><h4 data-v-acde3a8e>é™ªä¼´æ—¥å†</h4><div class="heatmap-legend" data-v-acde3a8e><span data-v-acde3a8e>å°‘</span><span class="legend-item level-1" data-v-acde3a8e></span><span class="legend-item level-2" data-v-acde3a8e></span><span class="legend-item level-3" data-v-acde3a8e></span><span class="legend-item level-4" data-v-acde3a8e></span><span data-v-acde3a8e>å¤š</span></div></div>',1)),ti.intimacyData.calendarMonths.length>0?((0,i.uX)(),(0,i.CE)("div",$a,[(0,i.Lk)("div",Xa,[(0,i.Lk)("button",{onClick:t[105]||(t[105]=(...e)=>si.prevMonth&&si.prevMonth(...e)),disabled:ti.currentMonthIndex>=ti.intimacyData.calendarMonths.length-1,class:"nav-btn",title:"ä¸Šä¸ªæœˆ"},"â—€",8,Oa),(0,i.Lk)("div",Ua,(0,o.v_)(ti.intimacyData.calendarMonths[ti.currentMonthIndex].year)+"å¹´ "+(0,o.v_)(ti.intimacyData.calendarMonths[ti.currentMonthIndex].month)+"æœˆ ",1),(0,i.Lk)("button",{onClick:t[106]||(t[106]=(...e)=>si.nextMonth&&si.nextMonth(...e)),disabled:ti.currentMonthIndex<=0,class:"nav-btn",title:"ä¸‹ä¸ªæœˆ"},"â–¶",8,za)]),(0,i.Lk)("div",Aa,[(0,i.Lk)("div",Ha,[t[188]||(t[188]=(0,i.Fv)('<div class="weekday-header" data-v-acde3a8e>æ—¥</div><div class="weekday-header" data-v-acde3a8e>ä¸€</div><div class="weekday-header" data-v-acde3a8e>äºŒ</div><div class="weekday-header" data-v-acde3a8e>ä¸‰</div><div class="weekday-header" data-v-acde3a8e>å››</div><div class="weekday-header" data-v-acde3a8e>äº”</div><div class="weekday-header" data-v-acde3a8e>å…­</div>',7)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.intimacyData.calendarMonths[ti.currentMonthIndex].paddingStart,e=>((0,i.uX)(),(0,i.CE)("div",{key:"pad-start-"+e,class:"day-cell padding"}))),128)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ti.intimacyData.calendarMonths[ti.currentMonthIndex].days,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.dateStr,class:(0,o.C4)(["day-cell",{"has-data":e.count>0}]),style:(0,o.Tr)({backgroundColor:e.bgStyle}),onMouseenter:t=>si.showDayTooltip(t,e),onMousemove:t[107]||(t[107]=e=>si.moveDayTooltip(e)),onMouseleave:t[108]||(t[108]=(...e)=>si.hideDayTooltip&&si.hideDayTooltip(...e))},[(0,i.Lk)("span",Qa,(0,o.v_)(e.dayNum),1)],46,Wa))),128))])]),(0,i.Lk)("div",Ja,[(0,i.Lk)("div",ja,[t[189]||(t[189]=(0,i.Lk)("span",{class:"f-label"},"æœ¬æœˆæ¶ˆæ¯",-1)),(0,i.Lk)("span",Va,(0,o.v_)(ti.intimacyData.calendarMonths[ti.currentMonthIndex].totalCount),1)]),t[191]||(t[191]=(0,i.Lk)("div",{class:"footer-divider"},null,-1)),(0,i.Lk)("div",Ga,[t[190]||(t[190]=(0,i.Lk)("span",{class:"f-label"},"æœ¬æœˆå­—æ•°",-1)),(0,i.Lk)("span",Ba,(0,o.v_)(ti.intimacyData.calendarMonths[ti.currentMonthIndex].totalChars),1)])])])):((0,i.uX)(),(0,i.CE)("div",Ya," æš‚æ— æ—¥å†æ•°æ® "))])])])])):(0,i.Q3)("",!0),(0,i.bo)((0,i.Lk)("div",{class:"custom-tooltip",style:(0,o.Tr)({left:ti.tooltip.x+"px",top:ti.tooltip.y+"px"})},[(0,i.Lk)("div",qa,(0,o.v_)(ti.tooltip.dateStr),1),(0,i.Lk)("div",Ka,[(0,i.bF)(ai,{icon:"pepicons-pencil:letter",class:"tooltip-icon"}),(0,i.Lk)("span",null,(0,o.v_)(ti.tooltip.count)+" æ¡æ¶ˆæ¯",1)]),(0,i.Lk)("div",Za,[(0,i.bF)(ai,{icon:"ri:draft-line",class:"tooltip-icon"}),(0,i.Lk)("span",null,(0,o.v_)(ti.tooltip.chars)+" å­—",1)])],4),[[a.aG,ti.tooltip.show]])],2)}s(4114),s(6573),s(8100),s(7936),s(116),s(7588),s(1701),s(3579),s(3110),s(9577),s(8335),s(1549),s(9797),s(9631),s(5623),s(4979),s(4603),s(7566),s(8721);var ti=s(23),si=s(9418),ai=s(2321),ii=s(1710),oi=s.n(ii),ni={name:"STReader",components:{Icon:ai.In},data(){return{viewMode:"home",loadingStatus:"",zipFileCache:null,fromDashboard:!1,dashboardSearch:"",dashboardData:{totalFiles:0,totalEffectiveCN:0,totalTurns:0,totalRerolls:0,groups:{}},isDarkMode:!1,metadata:{},messages:[],rawData:[],dashboardCalendar:{months:[],currentMonthIdx:0,totalMessages:0,activeDays:0},regexScripts:[],showRegexManager:!1,editingScript:null,scriptForm:{id:"",scriptName:"",findRegex:"",replaceString:"",disabled:!1},dragIndex:null,currentPage:1,pageSize:10,searchQuery:"",searchResults:[],currentSearchIndex:-1,showSearchBar:!1,editingMessageIndex:null,editingContent:"",tagFilters:[],showTagFilterManager:!1,editingTagFilter:null,tagFilterForm:{id:"",name:"",tagName:"",mode:"remove",disabled:!1},favorites:[],highlights:[],showFavoritesPanel:!1,selectionMenu:{show:!1,x:0,y:0,text:"",messageIndex:null},highlightMenu:{show:!1,x:0,y:0,highlightId:null},exportDialog:{show:!1,startFloor:1,endFloor:1,includeName:!0,includeTime:!0},showStylePanel:!1,textStyles:{fontFamily:"system",fontSize:16,lineHeight:1.8,paragraphSpacing:1,letterSpacing:0,textColor:"#1a1a1a",italicColor:"#1a1a1a",underlineColor:"#1a1a1a",quoteColor:"#1a1a1a",textAlign:"justify"},colorOptions:[{name:"é»˜è®¤é»‘",value:"#1a1a1a"},{name:"æ·±ç°",value:"#333333"},{name:"ä¸­ç°",value:"#555555"},{name:"æµ…ç°",value:"#666666"},{name:"æ£•è‰²",value:"#5d4037"},{name:"æ·±è“",value:"#1a237e"}],customFonts:[],showCustomFontDialog:!1,customFontForm:{name:"",url:"",file:null},readingMode:!1,toolbarVisible:!1,readingCurrentPage:1,readingTotalPages:1,readingFullHtml:"",readingTouchStartX:0,readingTouchStartY:0,toolbarTimeout:null,windowWidth:0,resizeTimer:null,keepReadingPagePosition:!1,showIntimacyModal:!1,intimacyData:{firstDate:"",daysSince:0,activeDays:0,totalMessages:0,totalChars:0,totalRerolls:0,calendarMonths:[]},currentMonthIndex:0,tooltip:{show:!1,x:0,y:0,dateStr:"",count:0,chars:0},resizeObserver:null}},computed:{filteredDashboardGroups(){const e=this.dashboardSearch.toLowerCase();if(!e)return this.dashboardData.groups;const t={};return Object.entries(this.dashboardData.groups).forEach(([s,a])=>{const i=s.toLowerCase().includes(e),o=a.filter(t=>t.fileName.toLowerCase().includes(e));i?t[s]=a:o.length>0&&(t[s]=o)}),t},filteredMessages(){if(!this.searchQuery.trim())return this.messages;const e=this.searchQuery.toLowerCase();return this.messages.filter((t,s)=>{const a=this.getMessageContent(t).toLowerCase(),i=(t.name||"").toLowerCase(),o=a.includes(e)||i.includes(e);return o&&(t._originalIndex=s),o})},totalPages(){return Math.ceil(this.filteredMessages.length/this.pageSize)},paginatedMessages(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.filteredMessages.slice(e,t)},currentRange(){const e=(this.currentPage-1)*this.pageSize+1,t=Math.min(this.currentPage*this.pageSize,this.filteredMessages.length);return{start:e,end:t}}},mounted(){console.log(this.viewMode),document.body.style.overflow="",this.loadScriptsFromStorage(),this.loadTagFiltersFromStorage(),this.loadFavoritesFromStorage(),this.loadHighlightsFromStorage(),this.loadStylesFromStorage(),this.loadDarkMode(),this.loadCustomFonts(),this.replaceHTMLPlaceholders(),document.addEventListener("mousedown",this.hideSelectionMenu),window.addEventListener("keydown",this.handleKeydown)},updated(){this.replaceHTMLPlaceholders(),document.addEventListener("mousedown",this.hideHighlightMenu),document.addEventListener("click",this.onHighlightClick)},beforeUnmount(){document.removeEventListener("mousedown",this.hideSelectionMenu),document.removeEventListener("mousedown",this.hideHighlightMenu),document.removeEventListener("click",this.onHighlightClick),window.removeEventListener("resize",this.handleResize),window.removeEventListener("keydown",this.handleKeydown),document.body.style.overflow="",this.toolbarTimeout&&clearTimeout(this.toolbarTimeout),this.resizeTimer&&clearTimeout(this.resizeTimer)},methods:{async handleZipUpload(e){const t=e.target.files[0];if(t){this.loadingStatus="æ­£åœ¨è§£æå‹ç¼©åŒ…ï¼Œè¯·ç¨å€™...";try{const e=await oi().loadAsync(t);this.zipFileCache=e;const s={totalFiles:0,totalEffectiveCN:0,totalTurns:0,totalRerolls:0,groups:{}},a=[];e.forEach((e,t)=>{if(t.dir||t.name.startsWith("__")||t.name.includes(".DS_Store")||!t.name.endsWith(".jsonl"))return;const i=t.async("text").then(e=>{const a=this.analyzeJsonlFast(e,t.name);if(a){s.totalFiles++,s.totalEffectiveCN+=a.effectiveCN,s.totalTurns+=a.totalTurns,s.totalRerolls+=a.rerolls;const e=a.characterName||"æœªçŸ¥è§’è‰²";s.groups[e]||(s.groups[e]=[]),s.groups[e].push(a)}});a.push(i)}),await Promise.all(a);const i={};Object.keys(s.groups).forEach(e=>{const t=s.groups[e];t.sort((e,t)=>t.fileName.localeCompare(e.fileName)),t.forEach(e=>{e.dateMap&&Object.entries(e.dateMap).forEach(([e,t])=>{i[e]||(i[e]={count:0,chars:0}),i[e].count+=t.count,i[e].chars+=t.chars})})}),this.generateDashboardCalendarData(i),this.dashboardData=s,this.viewMode="dashboard",this.loadingStatus=""}catch(s){console.error("ZIP è§£æå¤±è´¥:",s),alert("ZIP è§£æå¤±è´¥: "+s.message),this.loadingStatus=""}}},analyzeJsonlFast(e,t){try{const a=e.trim().split("\n");if(0===a.length)return null;let i={};try{i=JSON.parse(a[0])}catch(s){return null}const o=i.character_name||"æœªå‘½å",n=e.replace(/<think>[\s\S]*?<\/think>/gi,""),l=(n.match(/[\u4e00-\u9fa5]/g)||[]).length,r=Math.max(0,a.length-1);let c=0,d="æœªçŸ¥æ—¥æœŸ";const h={};for(let e=1;e<a.length;e++){const t=a[e];if(t.includes('"send_date"')||t.includes('"swipes"'))try{const s=JSON.parse(t);if(e>1&&s.swipes&&s.swipes.length>1&&(c+=s.swipes.length-1),e>1&&s.send_date){const e=this.parseSTDate(s.send_date);if(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),o=`${t}-${a}-${i}`;h[o]||(h[o]={count:0,chars:0}),h[o].count+=1;const n=s.swipes&&s.swipes.length>0&&s.swipes[s.swipe_id||0]||s.mes;n&&(h[o].chars+=n.length),d=s.send_date}}else s.send_date&&(d=s.send_date)}catch(s){}}if("æœªçŸ¥æ—¥æœŸ"!==d){const e=this.parseSTDate(d);e&&(d=`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`)}return{fileName:t,characterName:o,effectiveCN:l,totalTurns:r,rerolls:c,lastDate:d,dateMap:h}}catch(s){return console.warn("è§£ææ–‡ä»¶å‡ºé”™:",t,s),null}},async openChatFromDashboard(e){if(this.zipFileCache){this.loadingStatus="æ­£åœ¨åŠ è½½èŠå¤©è®°å½•...";try{const t=this.zipFileCache.file(e.fileName);if(!t)throw new Error("æ–‡ä»¶æœªæ‰¾åˆ°");const s=await t.async("text");this.parseJSONL(s),this.viewMode="reader",this.fromDashboard=!0,this.loadingStatus=""}catch(t){alert("åŠ è½½å¤±è´¥: "+t.message),this.loadingStatus=""}}},backToDashboard(){this.viewMode="dashboard",this.resetReaderStateOnly()},generateDashboardCalendarData(e){const t=Object.keys(e).sort();if(0===t.length)return void(this.dashboardCalendar={months:[],currentMonthIdx:0,totalMessages:0,activeDays:0});let s=0;Object.values(e).forEach(e=>{const t="number"===typeof e?e:e.count;t>s&&(s=t)});const a=[248,187,208],i=[136,14,79],o=t[0],n=t[t.length-1],l=new Date(o),r=new Date(n),c=[];let d=l.getFullYear(),h=l.getMonth();const g=r.getFullYear(),u=r.getMonth();let p=0;while(d<g||d===g&&h<=u){const t=new Date(d,h+1,0).getDate(),o=new Date(d,h,1),n=o.getDay(),l=[];let r=0,g=0;for(let c=1;c<=t;c++){const t=String(h+1).padStart(2,"0"),o=String(c).padStart(2,"0"),n=`${d}-${t}-${o}`,u=e[n]||{count:0,chars:0},m=u.count,v=u.chars;r+=m,g+=v,p+=m;const k=this.getGradientColor(m,s,a,i);l.push({dayNum:c,dateStr:n,count:m,chars:v,bgStyle:k})}c.push({year:d,month:h+1,paddingStart:n,days:l,totalCount:r,totalChars:g}),h++,h>11&&(h=0,d++)}this.dashboardCalendar.months=c.reverse(),this.dashboardCalendar.currentMonthIdx=0,this.dashboardCalendar.totalMessages=p,this.dashboardCalendar.activeDays=t.length},prevDashMonth(){this.dashboardCalendar.currentMonthIdx<this.dashboardCalendar.months.length-1&&this.dashboardCalendar.currentMonthIdx++},nextDashMonth(){this.dashboardCalendar.currentMonthIdx>0&&this.dashboardCalendar.currentMonthIdx--},resetReaderStateOnly(){this.metadata={},this.messages=[],this.rawData=[],this.currentPage=1,this.searchQuery="",this.readingMode=!1,document.body.style.overflow=""},toggleDarkMode(){this.isDarkMode=!this.isDarkMode;const e=["#000000","#1a1a1a","#333333"],t="#e0e0e0",s="#bfbfbf",a="#888888";if(this.isDarkMode)(e.includes(this.textStyles.textColor)||this.textStyles.textColor===s)&&(this.textStyles.textColor=t),(e.includes(this.textStyles.italicColor)||this.textStyles.italicColor===s)&&(this.textStyles.italicColor=t),(e.includes(this.textStyles.underlineColor)||this.textStyles.underlineColor===s)&&(this.textStyles.underlineColor=t),(e.includes(this.textStyles.quoteColor)||this.textStyles.quoteColor===s||this.textStyles.quoteColor===a)&&(this.textStyles.quoteColor=t),document.body.style.backgroundColor="#121212";else{const e=[t,s,a];e.includes(this.textStyles.textColor)&&(this.textStyles.textColor="#1a1a1a"),e.includes(this.textStyles.italicColor)&&(this.textStyles.italicColor="#1a1a1a"),e.includes(this.textStyles.underlineColor)&&(this.textStyles.underlineColor="#1a1a1a"),e.includes(this.textStyles.quoteColor)&&(this.textStyles.quoteColor="#1a1a1a"),document.body.style.backgroundColor=""}this.saveStylesToStorage(),localStorage.setItem("st_reader_dark_mode",this.isDarkMode)},loadDarkMode(){const e=localStorage.getItem("st_reader_dark_mode");"true"===e&&(this.isDarkMode=!0,document.body.style.backgroundColor="#121212")},handleFileUpload(e){const t=e.target.files[0];if(!t)return;const s=new FileReader;s.onload=e=>{this.parseJSONL(e.target.result),this.viewMode="reader",this.fromDashboard=!1},s.readAsText(t)},parseJSONL(e){const t=e.trim().split("\n");this.rawData=[],this.messages=[],this.metadata={},t.forEach((e,t)=>{try{const s=JSON.parse(e);if(0!==t||s.mes){let e=!1;!0!==s.is_user&&1!==s.is_user&&"true"!==s.is_user||(e=!0);let t=[];s.swipes&&Array.isArray(s.swipes)&&s.swipes.length>1&&(t=s.swipes);const a={name:s.name||"æœªçŸ¥",is_user:e,mes:s.mes||"",send_date:s.send_date||null,model:s.extra?.model||null,force_avatar:s.force_avatar||null,showPreview:!1,swipes:t,currentSwipeIndex:s.swipe_id||0};this.messages.push(a)}else this.metadata=s}catch(s){console.error(`è§£æç¬¬ ${t+1} è¡Œæ—¶å‡ºé”™:`,s)}})},hasHTMLCodeBlock(e){if(!e)return!1;const t=/```(?:html)?\s*([\s\S]*?)```/i,s=e.match(t);if(!s)return!1;const a=s[1].trim(),i=/<!DOCTYPE\s+html>/i.test(a),o=/<html[\s>]/i.test(a);return i&&o},extractHTMLFromCodeBlock(e){if(!e)return"";const t=/```(?:html)?\s*([\s\S]*?)```/i,s=e.match(t);return s?s[1].trim():""},renderContentWithoutCodeBlock(e){if(!e)return"";let t=this.applyTagFilters(e);t=this.applyRegexScripts(t);const s=t.replace(/```(?:html)?\s*[\s\S]*?```/gi,"").trim();return this.renderMarkdown(s)},renderContentWithHTMLPlaceholder(e,t){if(!e)return"";let s=this.applyTagFilters(e);s=this.applyRegexScripts(s);const a=this.extractHTMLFromCodeBlock(s);if(!a)return this.renderMarkdown(s);const i=btoa(unescape(encodeURIComponent(a))),o=`<div class="html-preview-placeholder" data-html-base64="${i}" data-message-idx="${t}"></div>`,n=s.replace(/```(?:html)?\s*[\s\S]*?```/gi,o);return this.renderMarkdown(n)},replaceHTMLPlaceholders(){const e=this.$el?.querySelectorAll(".html-preview-placeholder")||[];e.forEach(e=>{const t=e.getAttribute("data-html-base64");if(t&&e.parentNode)try{const s=decodeURIComponent(escape(atob(t))),a=document.createElement("iframe");a.className="html-iframe",a.setAttribute("sandbox","allow-scripts allow-same-origin"),a.srcdoc=s;const i=document.createElement("div");i.className="html-preview-section",i.appendChild(a),e.parentNode.replaceChild(i,e)}catch(s){console.error("æ›¿æ¢HTMLå ä½ç¬¦å¤±è´¥:",s)}})},renderMarkdown(e){if(!e)return"";ti.xI.setOptions({breaks:!0,gfm:!0,sanitize:!1,mangle:!1,headerIds:!1});let t=ti.xI.parse(e);return t=si.A.sanitize(t,this.getDOMPurifyConfig()),t},getDOMPurifyConfig(){return{ALLOWED_TAGS:["p","br","strong","em","u","del","code","pre","blockquote","h1","h2","h3","h4","h5","h6","ul","ol","li","a","img","span","div","b","i","s","strike","sub","sup","table","thead","tbody","tr","th","td","hr","details","summary","style","mark","small","big","abbr","cite","q","dl","dt","dd","figure","figcaption","main","section","article","header","footer","nav","aside","address","time","ruby","rt","rp","button","label","input","select","option","textarea","fieldset","legend","meter","progress","output","canvas","svg","path","circle","rect","line","polygon","polyline","g","defs","use","symbol","text","tspan"],ALLOWED_ATTR:["href","src","alt","title","class","style","width","height","align","target","rel","id","name","type","value","placeholder","disabled","readonly","checked","min","max","step","pattern","required","multiple","rows","cols","wrap","for","form","open","datetime","cite","download","d","fill","stroke","stroke-width","viewBox","xmlns","cx","cy","r","rx","ry","x","y","x1","y1","x2","y2","points","transform","opacity","font-size","text-anchor","onclick","onchange","oninput","data-floor"],ALLOW_DATA_ATTR:!0}},isFullHTML(e){if(!e)return!1;const t=e.trim();if(/^```/.test(t))return!1;const s=/<!DOCTYPE\s+html>/i.test(t),a=/<html[\s>]/i.test(t),i=/^<html[\s>]/i.test(t);return s&&a||i},toggleHTMLPreview(e){this.messages[e].showPreview=!this.messages[e].showPreview},getMessageContent(e){return e.swipes&&e.swipes.length>0&&e.swipes[e.currentSwipeIndex]||e.mes},prevSwipe(e){const t=this.messages[e];t.swipes&&t.currentSwipeIndex>0&&t.currentSwipeIndex--},nextSwipe(e){const t=this.messages[e];t.swipes&&t.currentSwipeIndex<t.swipes.length-1&&t.currentSwipeIndex++},getGlobalMessageIndex(e){return(this.currentPage-1)*this.pageSize+e},toggleEditMessage(e){if(this.editingMessageIndex===e)this.cancelEditMessage();else{const t=this.messages[e];this.editingContent=this.getMessageContent(t),this.editingMessageIndex=e}},cancelEditMessage(){this.editingMessageIndex=null,this.editingContent=""},saveEditMessage(){if(null===this.editingMessageIndex)return;const e=this.messages[this.editingMessageIndex];e.swipes&&e.swipes.length>0?e.swipes[e.currentSwipeIndex]=this.editingContent:e.mes=this.editingContent,this.cancelEditMessage()},renderContent(e,t){if(!e)return"";let s=this.applyTagFilters(e);s=this.applyRegexScripts(s);const a=[];let i=s;const o=e=>`{ST_READER_HTML_BLOCK_${e}}`,n=i.indexOf("<style");if(-1!==n){let e=i.length;const t=i.substring(n);let s=-1,l=t.indexOf("</div>",0);while(-1!==l)s=l+6,l=t.indexOf("</div>",l+1);if(-1!==s){const a=t.substring(s).trim();a.startsWith("<")&&!a.startsWith("</")||(e=n+s)}const r=i.substring(n,e);a.push(r),i=i.substring(0,n)+o(0)+i.substring(e)}i=i.replace(/<details[\s\S]*?<\/details>/gi,e=>(a.push(e),o(a.length-1))),ti.xI.setOptions({breaks:!0,gfm:!0,sanitize:!1,mangle:!1,headerIds:!1});let l=ti.xI.parse(i);return a.forEach((e,t)=>{const s=o(t);l=l.includes(`<p>${s}</p>`)?l.replace(`<p>${s}</p>`,e):l.replace(s,e)}),l=si.A.sanitize(l,this.getDOMPurifyConfig()),void 0!==t&&(l=this.applyHighlights(l,t)),l},applyHighlights(e,t){if(!this.highlights||0===this.highlights.length)return e;let s=e;for(const i of this.highlights)if(i.text&&i.messageIndex===t){const e=i.text.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");try{const t=new RegExp(`(${e})`);s=s.replace(t,`<span class="user-highlight" data-highlight-id="${i.id}">$1</span>`)}catch(a){}}return s},formatDate(e){if(!e)return"";let t;if("number"===typeof e)t=new Date(e);else{if("string"!==typeof e)return"";t=new Date(e),isNaN(t.getTime())&&(t=new Date(parseInt(e)))}if(isNaN(t.getTime()))return"";const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");return`${s}-${a}-${i} ${o}:${n}`},resetReader(){this.viewMode="home",this.resetReaderStateOnly(),this.zipFileCache=null,this.dashboardData={totalFiles:0,groups:{}},this.$refs.fileInput&&(this.$refs.fileInput.value=""),this.$refs.zipInput&&(this.$refs.zipInput.value="")},prevPage(){this.currentPage>1&&(this.currentPage--,this.scrollToTop())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.scrollToTop())},goToPage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e,this.scrollToTop())},onPageSizeChange(){this.currentPage>this.totalPages&&(this.currentPage=this.totalPages||1),this.scrollToTop()},scrollToTop(){this.$nextTick(()=>{const e=document.querySelector(".messages-wrapper");e&&e.scrollIntoView({behavior:"smooth",block:"start"})})},toggleSearchBar(){this.showSearchBar=!this.showSearchBar,this.showSearchBar?this.$nextTick(()=>{const e=document.querySelector(".search-input");e&&e.focus()}):this.clearSearch()},onSearchInput(){this.currentPage=1},clearSearch(){this.searchQuery="",this.currentPage=1},loadFavoritesFromStorage(){try{const e=localStorage.getItem("st_reader_favorites");e&&(this.favorites=JSON.parse(e))}catch(e){console.error("åŠ è½½æ”¶è—å¤±è´¥:",e)}},saveFavoritesToStorage(){try{localStorage.setItem("st_reader_favorites",JSON.stringify(this.favorites))}catch(e){console.error("ä¿å­˜æ”¶è—å¤±è´¥:",e)}},loadHighlightsFromStorage(){try{const e=localStorage.getItem("st_reader_highlights");e&&(this.highlights=JSON.parse(e))}catch(e){console.error("åŠ è½½é«˜äº®å¤±è´¥:",e)}},saveHighlightsToStorage(){try{localStorage.setItem("st_reader_highlights",JSON.stringify(this.highlights))}catch(e){console.error("ä¿å­˜é«˜äº®å¤±è´¥:",e)}},toggleFavoritesPanel(){this.showFavoritesPanel=!this.showFavoritesPanel},toggleFavoriteMessage(e,t){const s=this.favorites.findIndex(t=>"message"===t.type&&t.messageIndex===e);-1!==s?this.favorites.splice(s,1):this.favorites.unshift({id:this.generateUUID(),type:"message",messageIndex:e,text:this.getMessageContent(t),speaker:t.name,createdAt:Date.now()}),this.saveFavoritesToStorage()},isMessageFavorited(e){return this.favorites.some(t=>"message"===t.type&&t.messageIndex===e)},handleTextSelection(e,t,s){const a=window.getSelection(),i=a.toString().trim();i.length>0&&(this.selectionMenu={show:!0,x:e.clientX,y:e.clientY-40,text:i,messageIndex:t,speaker:s.name})},hideSelectionMenu(e){e.target.closest(".selection-menu")||(this.selectionMenu.show=!1)},favoriteSelectedText(){this.selectionMenu.text&&(this.favorites.unshift({id:this.generateUUID(),type:"text",messageIndex:this.selectionMenu.messageIndex,text:this.selectionMenu.text,speaker:this.selectionMenu.speaker,createdAt:Date.now()}),this.saveFavoritesToStorage(),this.selectionMenu.show=!1,window.getSelection().removeAllRanges())},highlightSelectedText(){this.selectionMenu.text&&(this.highlights.push({id:this.generateUUID(),messageIndex:this.selectionMenu.messageIndex,text:this.selectionMenu.text,createdAt:Date.now()}),this.saveHighlightsToStorage(),this.selectionMenu.show=!1,window.getSelection().removeAllRanges(),this.readingMode&&this.generateReadingContent())},deleteHighlight(e){const t=this.highlights.findIndex(t=>t.id===e);-1!==t&&(this.highlights.splice(t,1),this.saveHighlightsToStorage(),this.readingMode&&this.generateReadingContent())},onHighlightClick(e){const t=e.target.closest(".user-highlight");t&&t.dataset.highlightId&&(e.preventDefault(),e.stopPropagation(),this.highlightMenu={show:!0,x:e.clientX,y:e.clientY,highlightId:t.dataset.highlightId})},removeHighlightFromMenu(){this.highlightMenu.highlightId&&this.deleteHighlight(this.highlightMenu.highlightId),this.highlightMenu.show=!1},hideHighlightMenu(e){e&&e.target.closest(".highlight-menu")||(this.highlightMenu.show=!1)},navigateToFavorite(e){if(void 0===e.messageIndex||null===e.messageIndex)return;const t=e.messageIndex,s=Math.floor(t/this.pageSize)+1;s!==this.currentPage&&(this.currentPage=s),this.showFavoritesPanel=!1,this.$nextTick(()=>{const e=t%this.pageSize,s=document.querySelectorAll(".message-block");s[e]&&(s[e].scrollIntoView({behavior:"smooth",block:"center"}),s[e].classList.add("highlight-flash"),setTimeout(()=>{s[e].classList.remove("highlight-flash")},2e3))})},copySelectedText(){this.selectionMenu.text&&navigator.clipboard.writeText(this.selectionMenu.text).then(()=>{this.selectionMenu.show=!1})},copyFavorite(e){navigator.clipboard.writeText(e.text)},deleteFavorite(e){this.favorites=this.favorites.filter(t=>t.id!==e),this.saveFavoritesToStorage()},clearAllFavorites(){confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ”¶è—å—ï¼Ÿ")&&(this.favorites=[],this.saveFavoritesToStorage())},exportFavorites(){const e=JSON.stringify(this.favorites,null,2),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="favorites.json",a.click(),URL.revokeObjectURL(s)},formatFavoriteTime(e){const t=new Date(e);return`${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${String(t.getMinutes()).padStart(2,"0")}`},loadTagFiltersFromStorage(){try{const e=localStorage.getItem("st_reader_tag_filters");e&&(this.tagFilters=JSON.parse(e))}catch(e){console.error("åŠ è½½æ ‡ç­¾è¿‡æ»¤å™¨å¤±è´¥:",e)}},saveTagFiltersToStorage(){try{localStorage.setItem("st_reader_tag_filters",JSON.stringify(this.tagFilters))}catch(e){console.error("ä¿å­˜æ ‡ç­¾è¿‡æ»¤å™¨å¤±è´¥:",e)}},toggleTagFilterManager(){this.showTagFilterManager=!this.showTagFilterManager,this.showTagFilterManager||this.resetTagFilterForm()},resetTagFilterForm(){this.editingTagFilter=null,this.tagFilterForm={id:"",name:"",tagName:"",mode:"remove",disabled:!1}},addNewTagFilter(){this.resetTagFilterForm(),this.tagFilterForm.id=this.generateUUID()},editTagFilter(e){this.editingTagFilter=e.id,this.tagFilterForm={...e}},saveTagFilter(){if(this.tagFilterForm.name&&this.tagFilterForm.tagName){if(this.editingTagFilter){const e=this.tagFilters.findIndex(e=>e.id===this.editingTagFilter);-1!==e&&this.tagFilters.splice(e,1,{...this.tagFilterForm})}else this.tagFilters.push({...this.tagFilterForm});this.saveTagFiltersToStorage(),this.resetTagFilterForm()}else alert("è¯·å¡«å†™è¿‡æ»¤å™¨åç§°å’Œæ ‡ç­¾å")},cancelEditTagFilter(){this.resetTagFilterForm()},deleteTagFilter(e){confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¿‡æ»¤å™¨å—ï¼Ÿ")&&(this.tagFilters=this.tagFilters.filter(t=>t.id!==e),this.saveTagFiltersToStorage())},toggleTagFilter(e){e.disabled=!e.disabled,this.saveTagFiltersToStorage()},moveTagFilterUp(e){if(e>0){const t=this.tagFilters[e];this.tagFilters.splice(e,1),this.tagFilters.splice(e-1,0,t),this.saveTagFiltersToStorage()}},moveTagFilterDown(e){if(e<this.tagFilters.length-1){const t=this.tagFilters[e];this.tagFilters.splice(e,1),this.tagFilters.splice(e+1,0,t),this.saveTagFiltersToStorage()}},applyTagFilters(e){if(!e)return e;let t=e;for(const a of this.tagFilters)if(!a.disabled)try{const s=a.tagName.split(",").map(e=>e.trim()).filter(e=>e);for(const i of s){const s=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if("remove"===a.mode){const e=new RegExp(`<${s}[^>]*>[\\s\\S]*?<\\/${s}>`,"gi");t=t.replace(e,"");const a=new RegExp(`<${s}[^>]*/?>`,"gi");t=t.replace(a,"")}else if("keep"===a.mode){const a=new RegExp(`<${s}[^>]*>([\\s\\S]*?)<\\/${s}>`,"gi"),i=[];let o;while(null!==(o=a.exec(e)))i.push(o[1]);i.length>0&&(t=i.join("\n\n"))}else if("unwrap"===a.mode){const e=new RegExp(`<${s}[^>]*>([\\s\\S]*?)<\\/${s}>`,"gi");t=t.replace(e,"$1");const a=new RegExp(`<${s}[^>]*/?>`,"gi");t=t.replace(a,"")}}}catch(s){console.error(`æ ‡ç­¾è¿‡æ»¤å™¨ "${a.name}" æ‰§è¡Œå¤±è´¥:`,s)}return t},loadScriptsFromStorage(){try{const e=localStorage.getItem("st_reader_regex_scripts");e&&(this.regexScripts=JSON.parse(e))}catch(e){console.error("åŠ è½½æ­£åˆ™è„šæœ¬å¤±è´¥:",e)}},saveScriptsToStorage(){try{localStorage.setItem("st_reader_regex_scripts",JSON.stringify(this.regexScripts))}catch(e){console.error("ä¿å­˜æ­£åˆ™è„šæœ¬å¤±è´¥:",e)}},toggleRegexManager(){this.showRegexManager=!this.showRegexManager,this.showRegexManager||this.resetScriptForm()},resetScriptForm(){this.editingScript=null,this.scriptForm={id:"",scriptName:"",findRegex:"",replaceString:"",disabled:!1}},addNewScript(){this.resetScriptForm(),this.scriptForm.id=this.generateUUID()},editScript(e){this.editingScript=e.id,this.scriptForm={...e}},saveScript(){if(this.scriptForm.scriptName&&this.scriptForm.findRegex){if(this.editingScript){const e=this.regexScripts.findIndex(e=>e.id===this.editingScript);-1!==e&&this.regexScripts.splice(e,1,{...this.scriptForm})}else this.regexScripts.push({...this.scriptForm});this.saveScriptsToStorage(),this.resetScriptForm()}else alert("è¯·å¡«å†™è„šæœ¬åç§°å’Œæ­£åˆ™è¡¨è¾¾å¼")},cancelEdit(){this.resetScriptForm()},deleteScript(e){confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ­£åˆ™è„šæœ¬å—ï¼Ÿ")&&(this.regexScripts=this.regexScripts.filter(t=>t.id!==e),this.saveScriptsToStorage())},toggleScript(e){e.disabled=!e.disabled,this.saveScriptsToStorage()},moveScriptUp(e){if(e>0){const t=this.regexScripts[e];this.regexScripts.splice(e,1),this.regexScripts.splice(e-1,0,t),this.saveScriptsToStorage()}},moveScriptDown(e){if(e<this.regexScripts.length-1){const t=this.regexScripts[e];this.regexScripts.splice(e,1),this.regexScripts.splice(e+1,0,t),this.saveScriptsToStorage()}},handleDragStart(e){this.dragIndex=e},handleDragOver(e){e.preventDefault()},handleDrop(e,t){if(e.preventDefault(),null!==this.dragIndex&&this.dragIndex!==t){const e=this.regexScripts[this.dragIndex];this.regexScripts.splice(this.dragIndex,1),this.regexScripts.splice(t,0,e),this.saveScriptsToStorage()}this.dragIndex=null},handleDragEnd(){this.dragIndex=null},generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0,s="x"===e?t:3&t|8;return s.toString(16)})},importScripts(){const e=document.createElement("input");e.type="file",e.accept=".json",e.multiple=!0,e.onchange=async e=>{const t=Array.from(e.target.files);if(!t.length)return;let s=0,a=0;const i=e=>new Promise(t=>{const s=new FileReader;s.onload=s=>{try{const e=JSON.parse(s.target.result);t(e)}catch(a){console.error(`è§£ææ–‡ä»¶ ${e.name} å¤±è´¥:`,a),t(null)}},s.readAsText(e)}),o=await Promise.all(t.map(e=>i(e)));o.forEach(e=>{if(!e)return;s++;const t=Array.isArray(e)?e:[e];t.forEach(e=>{if(e.findRegex){const t={id:e.id||this.generateUUID(),scriptName:e.scriptName||"æœªå‘½åè„šæœ¬",findRegex:e.findRegex,replaceString:e.replaceString||"",disabled:e.disabled||!1},s=this.regexScripts.findIndex(e=>e.id===t.id);-1!==s?this.regexScripts.splice(s,1,t):this.regexScripts.push(t),a++}})}),a>0?(this.saveScriptsToStorage(),alert(`æˆåŠŸä» ${s} ä¸ªæ–‡ä»¶ä¸­å¯¼å…¥äº† ${a} ä¸ªè„šæœ¬`)):alert("æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ­£åˆ™è„šæœ¬æ•°æ®")},e.click()},exportScripts(){const e=JSON.stringify(this.regexScripts,null,2),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="regex_scripts.json",a.click(),URL.revokeObjectURL(s)},importFromCardOrPreset(){const e=document.createElement("input");e.type="file",e.accept=".png,.json",e.onchange=async e=>{const t=e.target.files[0];if(t)try{let e=null;if(t.name.toLowerCase().endsWith(".png")){const s=await t.arrayBuffer(),a=this.extractPNGChara(s);if(!a)return void alert("æœªèƒ½ä» PNG ä¸­è¯»å–æ•°æ®ï¼Œè¯·ç¡®ä¿è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è§’è‰²å¡æ–‡ä»¶ã€‚");e=JSON.parse(a)}else if(t.name.toLowerCase().endsWith(".json")){const s=await t.text();e=JSON.parse(s)}if(!e)return void alert("æ— æ³•è§£ææ–‡ä»¶æ•°æ®ã€‚");const s=this.findRegexScriptsInObject(e);if(!s||0===s.length)return void(e.prompts?alert('è¯¥ JSON æ–‡ä»¶åŒ…å« Prompt é¢„è®¾ï¼Œä½†æœªå‘ç° "regex_scripts" (æ­£åˆ™è„šæœ¬) å­—æ®µã€‚'):alert("åœ¨è¯¥æ–‡ä»¶ä¸­æœªæ‰¾åˆ°æ­£åˆ™è„šæœ¬æ•°æ®ã€‚"));this.batchImportScripts(s)}catch(s){console.error("å¯¼å…¥å¤±è´¥:",s),alert("å¯¼å…¥å¤±è´¥: "+s.message)}},e.click()},findRegexScriptsInObject(e){if(!e)return[];if(Array.isArray(e))return e.length>0&&(e[0].scriptName||e[0].regex||e[0].findRegex)?e:[];if(e.data?.extensions?.regex_scripts)return e.data.extensions.regex_scripts;if(e.extensions?.regex_scripts)return e.extensions.regex_scripts;if(e.regex_scripts)return e.regex_scripts;if(e.presets&&e.presets.regex_scripts)return e.presets.regex_scripts;for(const t in e)if("regex_scripts"===t&&Array.isArray(e[t]))return e[t];return[]},batchImportScripts(e){if(!Array.isArray(e))return;let t=0;e.forEach(e=>{const s=e.findRegex||e.regex,a=e.replaceString||e.replacement||"";if(s){const i={id:e.id||this.generateUUID(),scriptName:e.scriptName||"æœªå‘½åè„šæœ¬",findRegex:s,replaceString:a,disabled:e.disabled||!1},o=this.regexScripts.findIndex(e=>e.id===i.id||e.scriptName===i.scriptName);if(-1!==o){const e=this.regexScripts[o];e.findRegex===i.findRegex&&e.replaceString===i.replaceString||(i.id=this.generateUUID(),i.scriptName=i.scriptName+" (å¯¼å…¥å‰¯æœ¬)",this.regexScripts.push(i),t++)}else this.regexScripts.push(i),t++}}),t>0?(this.saveScriptsToStorage(),alert(`æˆåŠŸå¯¼å…¥ ${t} ä¸ªæ­£åˆ™è„šæœ¬ï¼`)):alert("æœªå¯¼å…¥ä»»ä½•æ–°è„šæœ¬ï¼ˆå¯èƒ½æ˜¯é‡å¤æˆ–æ ¼å¼æ— æ•ˆï¼‰ã€‚")},extractPNGChara(e){const t=new Uint8Array(e),s=[137,80,78,71,13,10,26,10];for(let o=0;o<8;o++)if(t[o]!==s[o])throw new Error("ä¸æ˜¯æœ‰æ•ˆçš„ PNG æ–‡ä»¶");let a=8;while(a<t.length){const e=t[a]<<24|t[a+1]<<16|t[a+2]<<8|t[a+3];a+=4;const s=String.fromCharCode(t[a],t[a+1],t[a+2],t[a+3]);if(a+=4,"tEXt"===s){const s=t.slice(a,a+e);let o=-1;for(let e=0;e<s.length;e++)if(0===s[e]){o=e;break}if(-1!==o){const e=(new TextDecoder).decode(s.slice(0,o));if("chara"===e){const e=(new TextDecoder).decode(s.slice(o+1));try{return this.decodeBase64UTF8(e)}catch(i){console.error("Base64 è§£ç å¤±è´¥:",i)}}}}if(a+=e+4,"IEND"===s)break}return null},decodeBase64UTF8(e){const t=atob(e),s=new Uint8Array(t.length);for(let a=0;a<t.length;a++)s[a]=t.charCodeAt(a);return new TextDecoder("utf-8").decode(s)},applyRegexScripts(e){if(!e)return e;let t=e;for(const a of this.regexScripts)if(!a.disabled)try{const e=a.findRegex.match(/^\/(.*)\/([gimsuy]*)$/);let s;s=e?new RegExp(e[1],e[2]):new RegExp(a.findRegex,"g"),t=t.replace(s,a.replaceString)}catch(s){console.error(`æ­£åˆ™è„šæœ¬ "${a.scriptName}" æ‰§è¡Œå¤±è´¥:`,s)}return t},openExportRangeDialog(){this.exportDialog={show:!0,startFloor:1,endFloor:this.filteredMessages.length,includeName:!0,includeTime:!0}},closeExportDialog(){this.exportDialog.show=!1},getExportCount(){const e=Math.max(1,Math.min(this.exportDialog.startFloor,this.filteredMessages.length)),t=Math.max(1,Math.min(this.exportDialog.endFloor,this.filteredMessages.length));return Math.max(0,t-e+1)},formatMessageForExport(e,t){let s=this.getMessageContent(e);s=this.applyTagFilters(s),s=this.applyRegexScripts(s),s=this.stripHtmlTags(s);let a="";return a+=`========== ç¬¬ ${t} æ¥¼ ==========\n`,this.exportDialog.includeName&&(a+=`ã€${e.name}ã€‘`),this.exportDialog.includeTime&&e.send_date&&(this.exportDialog.includeName&&(a+=" "),a+=`[${e.send_date}]`),(this.exportDialog.includeName||this.exportDialog.includeTime)&&(a+="\n\n"),a+=s,a},getExportPreview(){const e=Math.max(1,Math.min(this.exportDialog.startFloor,this.filteredMessages.length)),t=Math.max(1,Math.min(this.exportDialog.endFloor,this.filteredMessages.length));if(e>t||e<1)return"æ— æ•ˆçš„æ¥¼å±‚èŒƒå›´";const s=Math.min(3,t-e+1);let a="";for(let i=0;i<s;i++){const t=e+i,s=this.filteredMessages[t-1];s&&(i>0&&(a+="\n\n"),a+=this.formatMessageForExport(s,t))}return t-e+1>3&&(a+="\n\n...(è¿˜æœ‰ "+(t-e+1-3)+" æ¡æ¶ˆæ¯)"),a.length>800&&(a=a.substring(0,800)+"\n...(é¢„è§ˆå·²æˆªæ–­)"),a},stripHtmlTags(e){if(!e)return"";const t=document.createElement("div");t.innerHTML=e;let s=t.textContent||t.innerText||"";return s=s.replace(/\n{3,}/g,"\n\n"),s.trim()},doExportRange(){const e=Math.max(1,Math.min(this.exportDialog.startFloor,this.filteredMessages.length)),t=Math.max(1,Math.min(this.exportDialog.endFloor,this.filteredMessages.length));if(e>t||e<1)return void alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥¼å±‚èŒƒå›´");let s="";for(let r=e;r<=t;r++){const t=this.filteredMessages[r-1];t&&(r>e&&(s+="\n\n\n"),s+=this.formatMessageForExport(t,r))}const a=new Blob([s],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i;const n=(new Date).toISOString().slice(0,10),l=this.metadata.character_name||"èŠå¤©è®°å½•";o.download=`${l}_æ¥¼å±‚${e}-${t}_${n}.txt`,o.click(),URL.revokeObjectURL(i),this.closeExportDialog()},toggleStylePanel(){this.showStylePanel=!this.showStylePanel},loadStylesFromStorage(){try{const e=localStorage.getItem("st_reader_text_styles");if(e){const t=JSON.parse(e);this.textStyles={...this.textStyles,...t}}}catch(e){console.error("åŠ è½½æ ·å¼è®¾ç½®å¤±è´¥:",e)}},saveStylesToStorage(){try{localStorage.setItem("st_reader_text_styles",JSON.stringify(this.textStyles))}catch(e){console.error("ä¿å­˜æ ·å¼è®¾ç½®å¤±è´¥:",e)}},handleStyleChange(){this.saveStylesToStorage(),this.readingMode&&this.handleResize()},resetStyles(){const e=this.isDarkMode?"#e0e0e0":"#1a1a1a";this.textStyles={fontFamily:"system",fontSize:16,lineHeight:1.8,paragraphSpacing:1,letterSpacing:0,textColor:e,italicColor:e,underlineColor:e,quoteColor:e,textAlign:"justify"},this.saveStylesToStorage()},setTextColor(e){this.textStyles.textColor=e,this.saveStylesToStorage()},setTextAlign(e){this.textStyles.textAlign=e,this.saveStylesToStorage()},loadCustomFonts(){try{const e=localStorage.getItem("st_reader_custom_fonts");e&&(this.customFonts=JSON.parse(e),this.customFonts.forEach(e=>{this.registerFontFace(e)}))}catch(e){console.error("åŠ è½½è‡ªå®šä¹‰å­—ä½“å¤±è´¥:",e)}},saveCustomFonts(){try{localStorage.setItem("st_reader_custom_fonts",JSON.stringify(this.customFonts))}catch(e){console.error("ä¿å­˜è‡ªå®šä¹‰å­—ä½“å¤±è´¥:",e)}},registerFontFace(e){const t=document.createElement("style");t.id=`custom-font-${e.id}`,t.textContent=`\n        @font-face {\n          font-family: "${e.name}";\n          src: url("${e.url}") format("${e.format}");\n          font-weight: normal;\n          font-style: normal;\n          font-display: swap;\n        }\n      `,document.head.appendChild(t)},unregisterFontFace(e){const t=document.getElementById(`custom-font-${e}`);t&&t.remove()},async addCustomFont(){if(!this.customFontForm.name)return void alert("è¯·è¾“å…¥å­—ä½“åç§°");let e="",t="truetype";if(this.customFontForm.file)try{e=await this.fileToDataUrl(this.customFontForm.file),t=this.getFontFormat(this.customFontForm.file.name)}catch(i){return void alert("è¯»å–å­—ä½“æ–‡ä»¶å¤±è´¥: "+i.message)}else{if(!this.customFontForm.url)return void alert("è¯·é€‰æ‹©å­—ä½“æ–‡ä»¶æˆ–è¾“å…¥å­—ä½“URL");e=this.customFontForm.url,t=this.getFontFormat(this.customFontForm.url)}const s=Date.now().toString(),a={id:s,name:this.customFontForm.name,url:e,format:t};this.registerFontFace(a),this.customFonts.push(a),this.saveCustomFonts(),this.resetCustomFontForm(),this.showCustomFontDialog=!1,this.textStyles.fontFamily="custom-"+s,this.saveStylesToStorage()},deleteCustomFont(e){confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè‡ªå®šä¹‰å­—ä½“å—ï¼Ÿ")&&(this.textStyles.fontFamily==="custom-"+e&&(this.textStyles.fontFamily="system",this.saveStylesToStorage()),this.unregisterFontFace(e),this.customFonts=this.customFonts.filter(t=>t.id!==e),this.saveCustomFonts())},fileToDataUrl(e){return new Promise((t,s)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=s,a.readAsDataURL(e)})},getFontFormat(e){const t=e.split(".").pop().toLowerCase(),s={ttf:"truetype",otf:"opentype",woff:"woff",woff2:"woff2"};return s[t]||"truetype"},handleFontFileSelect(e){const t=e.target.files[0];t&&(this.customFontForm.file=t,this.customFontForm.name||(this.customFontForm.name=t.name.replace(/\.(ttf|otf|woff2?|TTF|OTF|WOFF2?)$/,"")))},resetCustomFontForm(){this.customFontForm={name:"",url:"",file:null};const e=this.$refs.fontFileInput;e&&(e.value="")},getPreviewStyles(){return{...this.getContentStyles(),color:"var(--main-color)"}},getContentStyles(){return{fontFamily:this.getFontFamily(),fontSize:this.textStyles.fontSize+"px",lineHeight:this.textStyles.lineHeight,textAlign:this.textStyles.textAlign,letterSpacing:this.textStyles.letterSpacing+"px","--main-color":this.textStyles.textColor,"--italic-color":this.textStyles.italicColor||this.textStyles.textColor,"--underline-color":this.textStyles.underlineColor||this.textStyles.textColor,"--quote-color":this.textStyles.quoteColor||"#666666","--paragraph-spacing":this.textStyles.paragraphSpacing+"em","--content-font":this.getFontFamily()}},getFontFamily(){const e={system:'-apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif',serif:'"Noto Serif SC", "Source Han Serif SC", "SimSun", "å®‹ä½“", serif',"sans-serif":'"Noto Sans SC", "Source Han Sans SC", "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif',kaiti:'"KaiTi", "æ¥·ä½“", "STKaiti", "åæ–‡æ¥·ä½“", serif',fangsong:'"FangSong", "ä»¿å®‹", "STFangsong", "åæ–‡ä»¿å®‹", serif',monospace:'"Consolas", "Monaco", "Source Code Pro", monospace',alegreya:'"Alegreya", serif',cangeryunhei:'"ä»“è€³äº‘é»‘", sans-serif',huiwenmingchao:'"æ±‡æ–‡æ˜æœ", serif',kongmingchao:'"ç©ºæ˜æœ", serif',pingxianzhensong:'"å±æ˜¾è‡»å®‹", serif',wenyueminguofangsong:'"æ–‡æ‚¦æ°‘å›½ä»¿å®‹", serif'};if(this.textStyles.fontFamily.startsWith("custom-")){const e=this.textStyles.fontFamily.replace("custom-",""),t=this.customFonts.find(t=>t.id===e);if(t)return`"${t.name}", sans-serif`}return e[this.textStyles.fontFamily]||e["system"]},toggleReadingMode(){this.readingMode=!this.readingMode,this.readingMode?(this.toolbarVisible=!1,this.showSearchBar=!1,this.showRegexManager=!1,this.showTagFilterManager=!1,this.showFavoritesPanel=!1,this.showStylePanel=!1,this.selectionMenu.show=!1,this.readingCurrentPage=1,document.body.style.overflow="hidden",this.generateReadingContent(),window.addEventListener("resize",this.handleResize),this.$nextTick(()=>{this.$refs.readingContentEl&&(this.resizeObserver=new ResizeObserver(()=>{window.requestAnimationFrame(()=>{this.calculateTotalPages()})}),this.resizeObserver.observe(this.$refs.readingContentEl))})):(document.body.style.overflow="",this.toolbarVisible=!1,window.removeEventListener("resize",this.handleResize),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null))},generateReadingContent(){let e="";const t=this.paginatedMessages,s=(this.currentPage-1)*this.pageSize;for(let a=0;a<t.length;a++){const i=t[a],o=s+a;let n=this.getMessageContent(i);n=this.renderContent(n,o),a>0&&(e+='<div class="reading-separator"></div>'),e+=`<div class="reading-message" data-floor="${o}">`,i.name&&(e+=`<p class="reading-speaker-name">ã€${i.name}ã€‘</p>`),e+=n,e+="</div>"}this.keepReadingPagePosition||(this.readingCurrentPage=1),this.keepReadingPagePosition=!1,this.readingFullHtml=e,this.$nextTick(()=>{const e=this.$refs.readingContentEl;e&&(e.style.width=""),this.updateColumnWidth(),this.$nextTick(()=>{setTimeout(()=>{this.calculateTotalPages()},50)})})},updateColumnWidth(){const e=this.$refs.readingContentEl;e&&(e.style.columnWidth=`${window.innerWidth}px`)},parseSTDate(e){if(!e)return null;if("number"===typeof e)return new Date(e);let t=String(e).trim();if(t.includes("@"))try{const e=t.replace("@","T").replace("h",":").replace("m",":").replace("s",""),s=new Date(e);if(!isNaN(s.getTime()))return s}catch(a){console.warn("è§£æ @ æ ¼å¼æ—¥æœŸå¤±è´¥:",t)}let s=new Date(t);if(!isNaN(s.getTime()))return s;if(/am|pm/i.test(t)&&!/\s(am|pm)/i.test(t)){const e=t.replace(/(\d)(am|pm)/i,"$1 $2");if(s=new Date(e),!isNaN(s.getTime()))return s}return null},calculateTotalPages(){const e=this.$refs.readingContentEl;if(!e)return;const t=window.innerWidth,s=e.scrollWidth,a=e.offsetWidth;s>a&&(e.style.width=`${s}px`),this.windowWidth=t;const i=Math.max(1,Math.ceil((s-20)/t)),o=i*t;e.style.width=`${o}px`,this.readingTotalPages=i,this.readingCurrentPage>this.readingTotalPages&&(this.readingCurrentPage=this.readingTotalPages),console.groupEnd()},handleResize(){this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(()=>{const e=this.$refs.readingContentEl;e&&(e.style.width=""),this.updateColumnWidth(),this.$nextTick(()=>{setTimeout(()=>{this.calculateTotalPages()},50)})},100)},getReadingTransform(){const e=(this.readingCurrentPage-1)*this.windowWidth;return{transform:`translateX(-${e}px)`,...this.getContentStyles()}},getReadingFloorRange(){const e=(this.currentPage-1)*this.pageSize+1,t=Math.min(this.currentPage*this.pageSize,this.filteredMessages.length);return`${e}-${t} æ¥¼`},readingPrevPage(){this.readingCurrentPage>1?this.readingCurrentPage--:this.currentPage>1&&(this.currentPage--,this.keepReadingPagePosition=!0,this.generateReadingContent(),this.$nextTick(()=>{setTimeout(()=>{this.readingCurrentPage=this.readingTotalPages},100)}))},readingNextPage(){this.readingCurrentPage<this.readingTotalPages?this.readingCurrentPage++:this.currentPage<this.totalPages&&(this.currentPage++,this.generateReadingContent())},handleReadingClick(e){const t=window.getSelection();if(t.toString().length>0)return;const{clientX:s}=e,{innerWidth:a}=window,i=.25*a,o=.75*a;s<i?this.readingPrevPage():s>o?this.readingNextPage():this.showReadingMenu=!this.showReadingMenu},onReadingTouchStart(e){this.readingTouchStartX=e.touches[0].clientX,this.readingTouchStartY=e.touches[0].clientY},onReadingTouchEnd(e){const t=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY,a=t-this.readingTouchStartX,i=s-this.readingTouchStartY;Math.abs(a)>Math.abs(i)&&Math.abs(a)>50&&(a>0?this.readingPrevPage():this.readingNextPage())},onReadingMouseUp(e){const t=window.getSelection(),s=t.toString().trim();if(s.length>0){let a=null;const i=t.getRangeAt(0),o=i.commonAncestorContainer;let n=3===o.nodeType?o.parentElement:o;while(n&&n!==document.body){if(n.classList&&n.classList.contains("reading-message")&&n.hasAttribute("data-floor")){a=parseInt(n.getAttribute("data-floor"));break}n=n.parentElement}this.selectionMenu={show:!0,x:e.clientX,y:e.clientY-40,text:s,messageIndex:a,speaker:null!==a&&this.filteredMessages[a]?this.filteredMessages[a].name:""}}},toggleToolbar(){this.toolbarVisible=!this.toolbarVisible,this.toolbarVisible&&(this.toolbarTimeout&&clearTimeout(this.toolbarTimeout),this.toolbarTimeout=setTimeout(()=>{this.toolbarVisible=!1},3e3))},handleKeydown(e){this.readingMode&&"Escape"===e.key&&this.toggleReadingMode(),this.readingMode&&("ArrowLeft"===e.key?this.readingPrevPage():"ArrowRight"===e.key&&this.readingNextPage())},openIntimacyModal(){this.calculateIntimacyStats(),this.showIntimacyModal=!0},calculateIntimacyStats(){if(!this.messages.length)return;const e=this.messages.filter(e=>e.send_date);if(!e.length)return;const t=[...e].sort((e,t)=>{const s=this.parseSTDate(e.send_date)?.getTime()||0,a=this.parseSTDate(t.send_date)?.getTime()||0;return s-a});let s=0,a=0;const i=new Map;t.forEach((e,t)=>{const o=this.getMessageContent(e),n=o?o.length:0;o&&(s+=n),t>0&&e.swipes&&e.swipes.length>1&&(a+=e.swipes.length-1);const l=this.parseSTDate(e.send_date);if(l){const e=l.getFullYear(),t=String(l.getMonth()+1).padStart(2,"0"),s=String(l.getDate()).padStart(2,"0"),a=`${e}-${t}-${s}`;i.has(a)||i.set(a,{count:0,chars:0});const o=i.get(a);o.count+=1,o.chars+=n}});let o=0;for(const d of i.values())d.count>o&&(o=d.count);const n=[248,187,208],l=[233,30,99],r=this.parseSTDate(t[0].send_date),c=this.parseSTDate(t[t.length-1].send_date)||new Date;if(r){this.intimacyData.firstDate=r.toLocaleDateString();const e=new Date;this.intimacyData.daysSince=Math.floor((e-r)/864e5);const t=[];let s=r.getFullYear(),a=r.getMonth();const d=c.getFullYear(),h=c.getMonth();while(s<d||s===d&&a<=h){const e=new Date(s,a+1,0).getDate(),r=new Date(s,a,1),c=r.getDay(),d=[];let h=0,g=0;for(let t=1;t<=e;t++){const e=String(a+1).padStart(2,"0"),r=String(t).padStart(2,"0"),c=`${s}-${e}-${r}`,u=i.get(c)||{count:0,chars:0},p=u.count,m=u.chars;h+=p,g+=m;const v=this.getGradientColor(p,o,n,l);d.push({dayNum:t,dateStr:c,count:p,chars:m,bgStyle:v})}t.push({year:s,month:a+1,paddingStart:c,days:d,totalCount:h,totalChars:g}),a++,a>11&&(a=0,s++)}this.intimacyData.calendarMonths=t.reverse(),this.currentMonthIndex=0}else this.intimacyData.calendarMonths=[];this.intimacyData.activeDays=i.size,this.intimacyData.totalMessages=this.messages.length,this.intimacyData.totalChars=s,this.intimacyData.totalRerolls=a},showDayTooltip(e,t){0!==t.count&&(this.tooltip.show=!0,this.tooltip.dateStr=t.dateStr,this.tooltip.count=t.count,this.tooltip.chars=t.chars,this.updateTooltipPos(e))},moveDayTooltip(e){this.tooltip.show&&this.updateTooltipPos(e)},hideDayTooltip(){this.tooltip.show=!1},updateTooltipPos(e){const t=15;this.tooltip.x=e.clientX+t,this.tooltip.y=e.clientY+t},prevMonth(){this.currentMonthIndex<this.intimacyData.calendarMonths.length-1&&this.currentMonthIndex++},nextMonth(){this.currentMonthIndex>0&&this.currentMonthIndex--},openDashboardIntimacy(e,t){const s={};let a=0;t.forEach(e=>{a+=e.rerolls||e.totalRerolls||0,e.dateMap&&Object.entries(e.dateMap).forEach(([e,t])=>{s[e]||(s[e]={count:0,chars:0}),"number"===typeof t?s[e].count+=t:(s[e].count+=t.count,s[e].chars+=t.chars)})});let i=0,o=0,n=0;Object.values(s).forEach(e=>{e.count>i&&(i=e.count),o+=e.count,n+=e.chars});const l=Object.keys(s).sort();let r=0;if(l.length>0){const e=new Date(l[0]),t=new Date;r=Math.floor((t-e)/864e5),this.intimacyData.firstDate=`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`}else this.intimacyData.firstDate="æœªçŸ¥";this.intimacyData.daysSince=r,this.intimacyData.activeDays=l.length,this.intimacyData.totalMessages=o,this.intimacyData.totalChars=n,this.intimacyData.totalRerolls=a;const c=[248,187,208],d=[194,24,91];if(l.length>0){const e=new Date(l[0]),t=new Date(l[l.length-1]),a=[];let o=e.getFullYear(),n=e.getMonth();const r=t.getFullYear(),h=t.getMonth();while(o<r||o===r&&n<=h){const e=new Date(o,n+1,0).getDate(),t=new Date(o,n,1),l=t.getDay(),r=[];let h=0,g=0;for(let a=1;a<=e;a++){const e=String(n+1).padStart(2,"0"),t=String(a).padStart(2,"0"),l=`${o}-${e}-${t}`,u=s[l]||{count:0,chars:0};h+=u.count,g+=u.chars;const p=this.getGradientColor(u.count,i,c,d);r.push({dayNum:a,dateStr:l,count:u.count,chars:u.chars,bgStyle:p})}a.push({year:o,month:n+1,paddingStart:l,days:r,totalCount:h,totalChars:g}),n++,n>11&&(n=0,o++)}this.intimacyData.calendarMonths=a.reverse(),this.currentMonthIndex=0}else this.intimacyData.calendarMonths=[];this.showIntimacyModal=!0},getGradientColor(e,t,s,a){if(0===e)return"";let i=e/t;i<.1&&(i=.1);const o=Math.round(s[0]+(a[0]-s[0])*i),n=Math.round(s[1]+(a[1]-s[1])*i),l=Math.round(s[2]+(a[2]-s[2])*i);return`rgb(${o}, ${n}, ${l})`}}},li=s(6262);const ri=(0,li.A)(ni,[["render",ei],["__scopeId","data-v-acde3a8e"]]);var ci=ri;(0,a.Ef)(ci).mount("#app")}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,a,i,o){if(!a){var n=1/0;for(d=0;d<e.length;d++){a=e[d][0],i=e[d][1],o=e[d][2];for(var l=!0,r=0;r<a.length;r++)(!1&o||n>=o)&&Object.keys(s.O).every(function(e){return s.O[e](a[r])})?a.splice(r--,1):(l=!1,o<n&&(n=o));if(l){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[a,i,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var i,o,n=a[0],l=a[1],r=a[2],c=0;if(n.some(function(t){return 0!==e[t]})){for(i in l)s.o(l,i)&&(s.m[i]=l[i]);if(r)var d=r(s)}for(t&&t(a);c<n.length;c++)o=n[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},a=self["webpackChunkst_reader"]=self["webpackChunkst_reader"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(1315)});a=s.O(a)})();
//# sourceMappingURL=app.2ec9a81a.js.map